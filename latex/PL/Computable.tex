\AgdaHide{
\begin{code}%
\>\AgdaKeyword{module} \AgdaModule{PL.Computable} \AgdaKeyword{where}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Empty}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Product} \AgdaKeyword{renaming} \AgdaSymbol{(}\AgdaInductiveConstructor{\_,\_} \AgdaSymbol{to} \AgdaInductiveConstructor{\_,p\_}\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Prelims}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{PL.Grammar}\<%
\\
\>\AgdaKeyword{open} \AgdaModule{PLgrammar}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Grammar} \AgdaFunction{Propositional-Logic}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Reduction} \AgdaFunction{Propositional-Logic} \AgdaDatatype{β}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{PL.Rules}\<%
\end{code}
}

\subsubsection{Computable Terms}

We define the sets of \emph{computable} proofs $C_\Gamma(\phi)$ for each context $\Gamma$ and proposition $\phi$ as follows:

\begin{align*}
C_\Gamma(\bot) & = \{ \delta \mid \Gamma \vdash \delta : \bot \text{ and } \delta \in SN \} \\
C_\Gamma(\phi \rightarrow \psi) & = \{ \delta \mid \Gamma : \delta : \phi \rightarrow \psi \text{ and } \forall \Delta ⊇ \Gamma . ∀ \epsilon \in C_\Delta(\phi). \delta \epsilon \in C_\Delta(\psi) \}
\end{align*}

\begin{code}%
\>\AgdaFunction{C} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{Context} \AgdaBound{P} \AgdaSymbol{→} \AgdaDatatype{Prop} \AgdaSymbol{→} \AgdaFunction{Proof} \AgdaBound{P} \AgdaSymbol{→} \AgdaPrimitiveType{Set}\<%
\\
\>\AgdaFunction{C} \AgdaBound{Γ} \AgdaInductiveConstructor{⊥P} \AgdaBound{δ} \AgdaSymbol{=} \AgdaBound{Γ} \AgdaDatatype{⊢} \AgdaBound{δ} \AgdaDatatype{∶} \AgdaInductiveConstructor{⊥P} \AgdaFunction{×} \AgdaDatatype{SN} \AgdaBound{δ}\<%
\\
\>\AgdaFunction{C} \AgdaBound{Γ} \AgdaSymbol{(}\AgdaBound{φ} \AgdaInductiveConstructor{⇛} \AgdaBound{ψ}\AgdaSymbol{)} \AgdaBound{δ} \AgdaSymbol{=} \AgdaBound{Γ} \AgdaDatatype{⊢} \AgdaBound{δ} \AgdaDatatype{∶} \AgdaBound{φ} \AgdaInductiveConstructor{⇛} \AgdaBound{ψ} \AgdaFunction{×} \<[32]%
\>[32]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{(∀} \AgdaBound{Q} \AgdaSymbol{\{}\AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Context} \AgdaBound{Q}\AgdaSymbol{\}} \AgdaBound{ρ} \AgdaBound{ε} \AgdaSymbol{→} \AgdaBound{ρ} \AgdaFunction{∶} \AgdaBound{Γ} \AgdaFunction{⇒R} \AgdaBound{Δ} \AgdaSymbol{→} \<[42]%
\>[42]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{C} \AgdaBound{Δ} \AgdaBound{φ} \AgdaBound{ε} \AgdaSymbol{→} \AgdaFunction{C} \AgdaBound{Δ} \AgdaBound{ψ} \AgdaSymbol{(}\AgdaFunction{appP} \AgdaSymbol{(}\AgdaBound{δ} \AgdaFunction{〈} \AgdaBound{ρ} \AgdaFunction{〉}\AgdaSymbol{)} \AgdaBound{ε}\AgdaSymbol{))}\<%
\end{code}

\begin{lemma}$ $
\begin{enumerate}
\item
If $\delta \in C_\Gamma(\phi)$ then $\Gamma \vdash \delta : \phi$.
\item
If $\delta \in C_\Gamma(\phi)$ and $\rho : \Gamma \rightarrow \Delta$ then $\delta \langle \rho \rangle \in C_\Delta(\phi)$.
\item
If $\delta \in C_\Gamma(\phi)$ and $\delta \rightarrow_\beta \epsilon$ then $\epsilon \in C_\Gamma(\phi)$.
\item
Let $\Gamma \vdash \delta : \phi$.  
If $\delta$ is neutral and, for all $\epsilon$ such that $\delta \rightarrow_\beta \epsilon$, we have $\epsilon \in C_\Gamma(\phi)$, then $\delta \in C_\Gamma(\phi)$.
\item
If $\delta \in C_\Gamma(\phi)$ then $\delta$ is strongly normalizable.
\end{enumerate}
\end{lemma}

\begin{code}%
\>\AgdaFunction{C-typed} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Context} \AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{φ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{δ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{C} \AgdaBound{Γ} \AgdaBound{φ} \AgdaBound{δ} \AgdaSymbol{→} \AgdaBound{Γ} \AgdaDatatype{⊢} \AgdaBound{δ} \AgdaDatatype{∶} \AgdaBound{φ}\<%
\end{code}

\AgdaHide{
\begin{code}%
\>\AgdaFunction{C-typed} \AgdaSymbol{\{}\AgdaArgument{φ} \AgdaSymbol{=} \AgdaInductiveConstructor{⊥P}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaField{proj₁}\<%
\\
\>\AgdaFunction{C-typed} \AgdaSymbol{\{}\AgdaArgument{φ} \AgdaSymbol{=} \AgdaSymbol{\_} \AgdaInductiveConstructor{⇛} \AgdaSymbol{\_\}} \AgdaSymbol{=} \AgdaField{proj₁}\<%
\end{code}
}

\begin{code}%
\>\AgdaFunction{C-rep} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Q}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Context} \AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Context} \AgdaBound{Q}\AgdaSymbol{\}} \AgdaBound{φ} \AgdaSymbol{\{}\AgdaBound{δ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{ρ}\AgdaSymbol{\}} \AgdaSymbol{→} \<[62]%
\>[62]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{C} \AgdaBound{Γ} \AgdaBound{φ} \AgdaBound{δ} \AgdaSymbol{→} \AgdaBound{ρ} \AgdaFunction{∶} \AgdaBound{Γ} \AgdaFunction{⇒R} \AgdaBound{Δ} \AgdaSymbol{→} \AgdaFunction{C} \AgdaBound{Δ} \AgdaBound{φ} \AgdaSymbol{(}\AgdaBound{δ} \AgdaFunction{〈} \AgdaBound{ρ} \AgdaFunction{〉}\AgdaSymbol{)}\<%
\end{code}

\AgdaHide{
\begin{code}%
\>\AgdaFunction{C-rep} \AgdaInductiveConstructor{⊥P} \AgdaSymbol{(}\AgdaBound{Γ⊢δ∶x₀} \AgdaInductiveConstructor{,p} \AgdaBound{SNδ}\AgdaSymbol{)} \AgdaBound{ρ∶Γ→Δ} \AgdaSymbol{=} \AgdaSymbol{(}\AgdaFunction{weakening} \AgdaBound{Γ⊢δ∶x₀} \AgdaBound{ρ∶Γ→Δ}\AgdaSymbol{)} \AgdaInductiveConstructor{,p} \AgdaFunction{SNrep} \AgdaFunction{β-creates-rep} \AgdaBound{SNδ}\<%
\\
\>\AgdaFunction{C-rep} \AgdaSymbol{\{}\AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Q}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Δ}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaBound{φ} \AgdaInductiveConstructor{⇛} \AgdaBound{ψ}\AgdaSymbol{)} \AgdaSymbol{\{}\AgdaBound{δ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{ρ}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaBound{Γ⊢δ∶φ⇒ψ} \AgdaInductiveConstructor{,p} \AgdaBound{Cδ}\AgdaSymbol{)} \AgdaBound{ρ∶Γ→Δ} \AgdaSymbol{=} \<[62]%
\>[62]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{(}\AgdaFunction{weakening} \AgdaBound{Γ⊢δ∶φ⇒ψ} \AgdaBound{ρ∶Γ→Δ}\AgdaSymbol{)} \AgdaInductiveConstructor{,p} \AgdaSymbol{(λ} \AgdaBound{R} \AgdaSymbol{\{}\AgdaBound{Θ}\AgdaSymbol{\}} \AgdaBound{σ} \AgdaBound{ε} \AgdaBound{σ∶Δ→Θ} \AgdaBound{ε∈CΘ} \AgdaSymbol{→} \AgdaFunction{subst} \AgdaSymbol{(}\AgdaFunction{C} \AgdaBound{Θ} \AgdaBound{ψ}\AgdaSymbol{)} \<[71]%
\>[71]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{(}\AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaFunction{appP} \AgdaBound{x} \AgdaBound{ε}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{rep-comp} \AgdaBound{δ}\AgdaSymbol{))}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{(}\AgdaBound{Cδ} \AgdaBound{R} \AgdaSymbol{(}\AgdaBound{σ} \AgdaFunction{•R} \AgdaBound{ρ}\AgdaSymbol{)} \AgdaBound{ε} \AgdaSymbol{(}\AgdaFunction{•R-typed} \AgdaSymbol{\{}\AgdaArgument{σ} \AgdaSymbol{=} \AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaArgument{ρ} \AgdaSymbol{=} \AgdaBound{ρ}\AgdaSymbol{\}} \AgdaBound{ρ∶Γ→Δ} \AgdaBound{σ∶Δ→Θ}\AgdaSymbol{)} \AgdaBound{ε∈CΘ}\AgdaSymbol{))}\<%
\end{code}
}

\begin{code}%
\>\AgdaFunction{C-osr} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Context} \AgdaBound{P}\AgdaSymbol{\}} \AgdaBound{φ} \AgdaSymbol{\{}\AgdaBound{δ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{ε}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{C} \AgdaBound{Γ} \AgdaBound{φ} \AgdaBound{δ} \AgdaSymbol{→} \AgdaBound{δ} \AgdaDatatype{⇒} \AgdaBound{ε} \AgdaSymbol{→} \AgdaFunction{C} \AgdaBound{Γ} \AgdaBound{φ} \AgdaBound{ε}\<%
\end{code}

\AgdaHide{
\begin{code}%
\>\AgdaFunction{C-osr} \AgdaSymbol{(}\AgdaInductiveConstructor{⊥P}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{Γ⊢δ∶x₀} \AgdaInductiveConstructor{,p} \AgdaBound{SNδ}\AgdaSymbol{)} \AgdaBound{δ→ε} \AgdaSymbol{=} \AgdaSymbol{(}\AgdaFunction{subject-reduction} \AgdaBound{Γ⊢δ∶x₀} \AgdaBound{δ→ε}\AgdaSymbol{)} \AgdaInductiveConstructor{,p} \AgdaSymbol{(}\AgdaFunction{SNred} \AgdaBound{SNδ} \AgdaSymbol{(}\AgdaInductiveConstructor{osr-red} \AgdaBound{δ→ε}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{C-osr} \AgdaSymbol{\{}\AgdaArgument{Γ} \AgdaSymbol{=} \AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaBound{φ} \AgdaInductiveConstructor{⇛} \AgdaBound{ψ}\AgdaSymbol{)} \AgdaSymbol{\{}\AgdaArgument{δ} \AgdaSymbol{=} \AgdaBound{δ}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaBound{Γ⊢δ∶φ⇒ψ} \AgdaInductiveConstructor{,p} \AgdaBound{Cδ}\AgdaSymbol{)} \AgdaBound{δ→δ'} \AgdaSymbol{=} \AgdaFunction{subject-reduction} \AgdaBound{Γ⊢δ∶φ⇒ψ} \AgdaBound{δ→δ'} \AgdaInductiveConstructor{,p} \<[87]%
\>[87]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{(λ} \AgdaBound{Q} \AgdaBound{ρ} \AgdaBound{ε} \AgdaBound{ρ∶Γ→Δ} \AgdaBound{ε∈Cφ} \AgdaSymbol{→} \AgdaFunction{C-osr} \AgdaBound{ψ} \AgdaSymbol{(}\AgdaBound{Cδ} \AgdaBound{Q} \AgdaBound{ρ} \AgdaBound{ε} \AgdaBound{ρ∶Γ→Δ} \AgdaBound{ε∈Cφ}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{app} \AgdaSymbol{(}\AgdaInductiveConstructor{appl} \AgdaSymbol{(}\AgdaFunction{respects-osr} \AgdaFunction{REP} \AgdaFunction{β-respects-rep} \AgdaBound{δ→δ'}\AgdaSymbol{))))}\<%
\\
%
\\
\>\AgdaFunction{C-red} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Context} \AgdaBound{P}\AgdaSymbol{\}} \AgdaBound{φ} \AgdaSymbol{\{}\AgdaBound{δ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{ε}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{C} \AgdaBound{Γ} \AgdaBound{φ} \AgdaBound{δ} \AgdaSymbol{→} \AgdaBound{δ} \AgdaDatatype{↠} \AgdaBound{ε} \AgdaSymbol{→} \AgdaFunction{C} \AgdaBound{Γ} \AgdaBound{φ} \AgdaBound{ε}\<%
\\
\>\AgdaFunction{C-red} \AgdaBound{φ} \AgdaBound{δ∈CΓφ} \AgdaSymbol{(}\AgdaInductiveConstructor{osr-red} \AgdaBound{δ⇒ε}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{C-osr} \AgdaBound{φ} \AgdaBound{δ∈CΓφ} \AgdaBound{δ⇒ε}\<%
\\
\>\AgdaFunction{C-red} \AgdaSymbol{\_} \AgdaBound{δ∈CΓφ} \AgdaInductiveConstructor{ref} \AgdaSymbol{=} \AgdaBound{δ∈CΓφ}\<%
\\
\>\AgdaFunction{C-red} \AgdaBound{φ} \AgdaBound{δ∈CΓφ} \AgdaSymbol{(}\AgdaInductiveConstructor{trans-red} \AgdaBound{δ↠ε} \AgdaBound{ε↠χ}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{C-red} \AgdaBound{φ} \AgdaSymbol{(}\AgdaFunction{C-red} \AgdaBound{φ} \AgdaBound{δ∈CΓφ} \AgdaBound{δ↠ε}\AgdaSymbol{)} \AgdaBound{ε↠χ}\<%
\end{code}
}

\begin{code}%
\>\AgdaFunction{NeutralC} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Context} \AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{δ} \AgdaSymbol{:} \AgdaFunction{Proof} \AgdaSymbol{(} \AgdaBound{P}\AgdaSymbol{)\}} \AgdaSymbol{(}\AgdaBound{φ} \AgdaSymbol{:} \AgdaDatatype{Prop}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaBound{Γ} \AgdaDatatype{⊢} \AgdaBound{δ} \AgdaDatatype{∶} \AgdaBound{φ} \AgdaSymbol{→} \AgdaDatatype{Neutral} \AgdaBound{δ} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{(∀} \AgdaBound{ε} \AgdaSymbol{→} \AgdaBound{δ} \AgdaDatatype{⇒} \AgdaBound{ε} \AgdaSymbol{→} \AgdaFunction{C} \AgdaBound{Γ} \AgdaBound{φ} \AgdaBound{ε}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{C} \AgdaBound{Γ} \AgdaBound{φ} \AgdaBound{δ}\<%
\\
%
\\
\>\AgdaFunction{CsubSN} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Context} \AgdaBound{P}\AgdaSymbol{\}} \AgdaBound{φ} \AgdaSymbol{\{}\AgdaBound{δ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{C} \AgdaBound{Γ} \AgdaBound{φ} \AgdaBound{δ} \AgdaSymbol{→} \AgdaDatatype{SN} \AgdaBound{δ}\<%
\end{code}

\AgdaHide{
\begin{code}%
\>\AgdaFunction{NeutralC} \AgdaSymbol{\{}\AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{δ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{⊥P}\AgdaSymbol{\}} \AgdaBound{Γ⊢δ∶x₀} \AgdaBound{Neutralδ} \AgdaBound{hyp} \AgdaSymbol{=} \AgdaBound{Γ⊢δ∶x₀} \AgdaInductiveConstructor{,p} \AgdaInductiveConstructor{SNI} \AgdaBound{δ} \AgdaSymbol{(λ} \AgdaBound{ε} \AgdaBound{δ→ε} \AgdaSymbol{→} \AgdaField{proj₂} \AgdaSymbol{(}\AgdaBound{hyp} \AgdaBound{ε} \AgdaBound{δ→ε}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{NeutralC} \AgdaSymbol{\{}\AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{δ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{φ} \AgdaInductiveConstructor{⇛} \AgdaBound{ψ}\AgdaSymbol{\}} \AgdaBound{Γ⊢δ∶φ→ψ} \AgdaBound{neutralδ} \AgdaBound{hyp} \AgdaSymbol{=} \AgdaBound{Γ⊢δ∶φ→ψ} \AgdaInductiveConstructor{,p} \<[63]%
\>[63]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{(λ} \AgdaBound{Q} \AgdaBound{ρ} \AgdaBound{ε} \AgdaBound{ρ∶Γ→Δ} \AgdaBound{ε∈Cφ} \AgdaSymbol{→} \AgdaFunction{claim} \AgdaBound{ε} \AgdaSymbol{(}\AgdaFunction{CsubSN} \AgdaBound{φ} \AgdaSymbol{\{}\AgdaArgument{δ} \AgdaSymbol{=} \AgdaBound{ε}\AgdaSymbol{\}} \AgdaBound{ε∈Cφ}\AgdaSymbol{)} \AgdaBound{ρ∶Γ→Δ} \AgdaBound{ε∈Cφ}\AgdaSymbol{)} \AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{claim} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{Q}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Δ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{ρ} \AgdaSymbol{:} \AgdaFunction{Rep} \AgdaBound{P} \AgdaBound{Q}\AgdaSymbol{\}} \AgdaBound{ε} \AgdaSymbol{→} \AgdaDatatype{SN} \AgdaBound{ε} \AgdaSymbol{→} \AgdaBound{ρ} \AgdaFunction{∶} \AgdaBound{Γ} \AgdaFunction{⇒R} \AgdaBound{Δ} \AgdaSymbol{→} \AgdaFunction{C} \AgdaBound{Δ} \AgdaBound{φ} \AgdaBound{ε} \AgdaSymbol{→} \AgdaFunction{C} \AgdaBound{Δ} \AgdaBound{ψ} \AgdaSymbol{(}\AgdaFunction{appP} \AgdaSymbol{(}\AgdaBound{δ} \AgdaFunction{〈} \<[86]%
\>[86]\AgdaBound{ρ} \AgdaFunction{〉}\AgdaSymbol{)} \AgdaBound{ε}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{claim} \AgdaSymbol{\{}\AgdaBound{Q}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Δ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{ρ}\AgdaSymbol{\}} \AgdaBound{ε} \AgdaSymbol{(}\AgdaInductiveConstructor{SNI} \AgdaSymbol{.}\AgdaBound{ε} \AgdaBound{SNε}\AgdaSymbol{)} \AgdaBound{ρ∶Γ→Δ} \AgdaBound{ε∈Cφ} \AgdaSymbol{=} \AgdaFunction{NeutralC} \AgdaSymbol{\{}\AgdaBound{Q}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Δ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaFunction{appP} \AgdaSymbol{(}\AgdaBound{δ} \AgdaFunction{〈} \<[77]%
\>[77]\AgdaBound{ρ} \AgdaFunction{〉}\AgdaSymbol{)} \AgdaBound{ε}\AgdaSymbol{\}} \AgdaBound{ψ}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaInductiveConstructor{app} \<[11]%
\>[11]\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaFunction{weakening} \AgdaBound{Γ⊢δ∶φ→ψ} \AgdaBound{ρ∶Γ→Δ}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaFunction{C-typed} \AgdaSymbol{\{}\AgdaBound{Q}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Δ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{φ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{ε}\AgdaSymbol{\}} \AgdaBound{ε∈Cφ}\AgdaSymbol{))} \<[38]%
\>[38]\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaInductiveConstructor{appNeutral} \AgdaSymbol{(}\AgdaBound{δ} \AgdaFunction{〈} \<[24]%
\>[24]\AgdaBound{ρ} \AgdaFunction{〉}\AgdaSymbol{)} \AgdaBound{ε}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaFunction{NeutralC-lm} \AgdaSymbol{\{}\AgdaArgument{X} \AgdaSymbol{=} \AgdaFunction{C} \AgdaBound{Δ} \AgdaBound{ψ}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaFunction{neutral-rep} \AgdaBound{neutralδ}\AgdaSymbol{)} \<[54]%
\>[54]\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(λ} \AgdaBound{δ'} \AgdaBound{δ〈ρ〉→δ'} \AgdaSymbol{→} \<[22]%
\>[22]\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaKeyword{let} \AgdaBound{δ-creation} \AgdaSymbol{=} \AgdaFunction{create-osr} \AgdaFunction{β-creates-rep} \AgdaBound{δ} \AgdaBound{δ〈ρ〉→δ'} \AgdaKeyword{in} \<[63]%
\>[63]\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaKeyword{let} \AgdaKeyword{open} \AgdaModule{creation} \AgdaBound{δ-creation} \AgdaKeyword{renaming} \AgdaSymbol{(}created \AgdaSymbol{to} δ₀\AgdaSymbol{;}red-created \AgdaSymbol{to} δ⇒δ₀\AgdaSymbol{;}ap-created \AgdaSymbol{to} δ₀〈ρ〉≡δ'\AgdaSymbol{)} \AgdaKeyword{in}\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaKeyword{let} \AgdaBound{δ₀∈C[φ⇒ψ]} \AgdaSymbol{:} \AgdaFunction{C} \AgdaBound{Γ} \AgdaSymbol{(}\AgdaBound{φ} \AgdaInductiveConstructor{⇛} \AgdaBound{ψ}\AgdaSymbol{)} \AgdaFunction{δ₀}\<%
\\
\>[8]\AgdaIndent{12}{}\<[12]%
\>[12]\AgdaBound{δ₀∈C[φ⇒ψ]} \AgdaSymbol{=} \AgdaBound{hyp} \AgdaFunction{δ₀} \AgdaFunction{δ⇒δ₀}\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaKeyword{in} \AgdaKeyword{let} \AgdaBound{δ'∈C[φ⇒ψ]} \AgdaSymbol{:} \AgdaFunction{C} \AgdaBound{Δ} \AgdaSymbol{(}\AgdaBound{φ} \AgdaInductiveConstructor{⇛} \AgdaBound{ψ}\AgdaSymbol{)} \AgdaBound{δ'}\<%
\\
\>[8]\AgdaIndent{15}{}\<[15]%
\>[15]\AgdaBound{δ'∈C[φ⇒ψ]} \AgdaSymbol{=} \AgdaFunction{subst} \AgdaSymbol{(}\AgdaFunction{C} \AgdaBound{Δ} \AgdaSymbol{(}\AgdaBound{φ} \AgdaInductiveConstructor{⇛} \AgdaBound{ψ}\AgdaSymbol{))} \AgdaFunction{δ₀〈ρ〉≡δ'} \AgdaSymbol{(}\AgdaFunction{C-rep} \AgdaSymbol{(}\AgdaBound{φ} \AgdaInductiveConstructor{⇛} \AgdaBound{ψ}\AgdaSymbol{)} \AgdaBound{δ₀∈C[φ⇒ψ]} \AgdaBound{ρ∶Γ→Δ}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaKeyword{in} \AgdaFunction{subst} \AgdaSymbol{(}\AgdaFunction{C} \AgdaBound{Δ} \AgdaBound{ψ}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaFunction{appP} \AgdaBound{x} \AgdaBound{ε}\AgdaSymbol{)} \AgdaFunction{δ₀〈ρ〉≡δ'}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{proj₂} \AgdaBound{δ₀∈C[φ⇒ψ]} \AgdaBound{Q} \AgdaBound{ρ} \AgdaBound{ε} \AgdaBound{ρ∶Γ→Δ} \AgdaBound{ε∈Cφ}\AgdaSymbol{))}\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(λ} \AgdaBound{ε'} \AgdaBound{ε→ε'} \AgdaSymbol{→} \AgdaFunction{claim} \AgdaBound{ε'} \AgdaSymbol{(}\AgdaBound{SNε} \AgdaBound{ε'} \AgdaBound{ε→ε'}\AgdaSymbol{)} \AgdaBound{ρ∶Γ→Δ} \AgdaSymbol{(}\AgdaFunction{C-osr} \AgdaBound{φ} \AgdaBound{ε∈Cφ} \AgdaBound{ε→ε'}\AgdaSymbol{)))}\<%
\\
%
\\
\>\AgdaFunction{CsubSN} \AgdaSymbol{\{}\AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{⊥P}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaField{proj₂}\<%
\\
\>\AgdaFunction{CsubSN} \AgdaSymbol{\{}\AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{φ} \AgdaInductiveConstructor{⇛} \AgdaBound{ψ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{δ}\AgdaSymbol{\}} \AgdaBound{P₁} \AgdaSymbol{=} \<[32]%
\>[32]\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{SNap'} \AgdaSymbol{\{}\AgdaFunction{REP}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{P} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{-proof}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaArgument{E} \AgdaSymbol{=} \AgdaBound{δ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaArgument{σ} \AgdaSymbol{=} \AgdaFunction{upRep}\AgdaSymbol{\}} \AgdaFunction{β-respects-rep}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaFunction{SNsubbodyl} \AgdaSymbol{(}\AgdaFunction{SNsubexp} \AgdaSymbol{(}\AgdaFunction{CsubSN} \AgdaSymbol{\{}\AgdaArgument{Γ} \AgdaSymbol{=} \AgdaBound{Γ} \AgdaFunction{,P} \AgdaBound{φ}\AgdaSymbol{\}} \AgdaBound{ψ}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaField{proj₂} \AgdaBound{P₁} \AgdaSymbol{(}\AgdaBound{P} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{-proof}\AgdaSymbol{)} \AgdaFunction{upRep} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaInductiveConstructor{x₀}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{↑-typed} \AgdaSymbol{\{}\AgdaArgument{φ} \AgdaSymbol{=} \AgdaBound{φ}\AgdaSymbol{\})}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaFunction{NeutralC} \AgdaBound{φ} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaSymbol{\_)}\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{(}\AgdaInductiveConstructor{varNeutral} \AgdaInductiveConstructor{x₀}\AgdaSymbol{)} \<[24]%
\>[24]\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{(λ} \AgdaBound{\_} \AgdaSymbol{()))))))}\<%
\end{code}
}

\begin{corollary}
If $p : \phi \in \Gamma$ then $p \in C_\Gamma(\phi)$.
\end{corollary}

\begin{code}%
\>\AgdaFunction{varC} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Context} \AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaDatatype{Var} \AgdaBound{P} \AgdaInductiveConstructor{-proof}\AgdaSymbol{\}} \AgdaSymbol{→} \<[50]%
\>[50]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{C} \AgdaBound{Γ} \AgdaSymbol{(}\AgdaFunction{unprp} \AgdaSymbol{(}\AgdaFunction{typeof} \AgdaBound{x} \AgdaBound{Γ}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaBound{x}\AgdaSymbol{)}\<%
\end{code}

\AgdaHide{
\begin{code}%
\>\AgdaFunction{varC} \AgdaSymbol{\{}\AgdaArgument{Γ} \AgdaSymbol{=} \AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaFunction{NeutralC} \AgdaSymbol{(}\AgdaFunction{unprp} \AgdaSymbol{(}\AgdaFunction{typeof} \AgdaBound{x} \AgdaBound{Γ}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{varNeutral} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{(λ} \AgdaBound{\_} \AgdaSymbol{())}\<%
\end{code}
}

\begin{lemma}[Computability is preserved under well-typed expansion]
Suppose $\Gamma, p : \phi \vdash \delta : \psi$ and $\Gamma \vdash \epsilon : \phi$.  If
$\delta[p:=\epsilon] \in C_\Gamma(\psi)$ and $\epsilon \in SN$, then $(\lambda p:\phi.\delta)\epsilon \in C_\Gamma(\psi)$.
\end{lemma}

\AgdaHide{
\begin{code}%
\>\AgdaFunction{WTEaux} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Context} \AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{φ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{δ}\AgdaSymbol{\}} \AgdaBound{ψ} \AgdaSymbol{\{}\AgdaBound{ε}\AgdaSymbol{\}} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaBound{Γ} \AgdaFunction{,P} \AgdaBound{φ} \AgdaDatatype{⊢} \AgdaBound{δ} \AgdaDatatype{∶} \AgdaBound{ψ} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaBound{Γ} \AgdaDatatype{⊢} \AgdaBound{ε} \AgdaDatatype{∶} \AgdaBound{φ} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{C} \AgdaBound{Γ} \AgdaBound{ψ} \AgdaSymbol{(}\AgdaBound{δ} \AgdaFunction{⟦} \AgdaFunction{x₀:=} \AgdaBound{ε} \AgdaFunction{⟧}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaDatatype{SN} \AgdaBound{δ} \AgdaSymbol{→} \AgdaDatatype{SN} \AgdaBound{ε} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{C} \AgdaBound{Γ} \AgdaBound{ψ} \AgdaSymbol{(}\AgdaFunction{appP} \AgdaSymbol{(}\AgdaFunction{ΛP} \AgdaBound{φ} \AgdaBound{δ}\AgdaSymbol{)} \AgdaBound{ε}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{WTEaux} \AgdaSymbol{\{}\AgdaArgument{Γ} \AgdaSymbol{=} \AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaArgument{φ} \AgdaSymbol{=} \AgdaBound{φ}\AgdaSymbol{\}} \AgdaBound{ψ} \AgdaBound{Γ,p∶φ⊢δ∶ψ} \AgdaBound{Γ⊢ε∶φ} \AgdaBound{δ[p∶=ε]∈CΓψ} \AgdaSymbol{(}\AgdaInductiveConstructor{SNI} \AgdaBound{δ} \AgdaBound{SNδ}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{SNI} \AgdaBound{ε} \AgdaBound{SNε}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{NeutralC} \AgdaSymbol{\{}\AgdaArgument{Γ} \AgdaSymbol{=} \AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaArgument{δ} \AgdaSymbol{=} \AgdaFunction{appP} \AgdaSymbol{(}\AgdaFunction{ΛP} \AgdaBound{φ} \AgdaBound{δ}\AgdaSymbol{)} \AgdaBound{ε}\AgdaSymbol{\}} \AgdaBound{ψ}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{(}\AgdaInductiveConstructor{app} \AgdaSymbol{(}\AgdaInductiveConstructor{Λ} \AgdaBound{Γ,p∶φ⊢δ∶ψ}\AgdaSymbol{)} \AgdaBound{Γ⊢ε∶φ}\AgdaSymbol{)} \<[28]%
\>[28]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{(}\AgdaInductiveConstructor{appNeutral} \AgdaSymbol{\_} \AgdaSymbol{\_)} \<[19]%
\>[19]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{(λ} \AgdaBound{χ} \AgdaBound{Λφδε⇒χ} \AgdaSymbol{→} \AgdaFunction{red-β-redex} \AgdaSymbol{(}\AgdaFunction{C} \AgdaBound{Γ} \AgdaBound{ψ}\AgdaSymbol{)} \AgdaBound{Λφδε⇒χ} \AgdaBound{δ[p∶=ε]∈CΓψ}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{(λ} \AgdaBound{δ'} \AgdaBound{δ⇒δ'} \AgdaSymbol{→} \AgdaFunction{WTEaux} \AgdaBound{ψ}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaFunction{subject-reduction} \AgdaBound{Γ,p∶φ⊢δ∶ψ} \AgdaBound{δ⇒δ'}\AgdaSymbol{)} \<[41]%
\>[41]\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaBound{Γ⊢ε∶φ} \<[12]%
\>[12]\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaFunction{C-osr} \AgdaBound{ψ} \AgdaBound{δ[p∶=ε]∈CΓψ} \AgdaSymbol{(}\AgdaFunction{respects-osr} \AgdaFunction{SUB} \AgdaFunction{β-respects-sub} \AgdaBound{δ⇒δ'}\AgdaSymbol{))} \<[67]%
\>[67]\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaBound{SNδ} \AgdaBound{δ'} \AgdaBound{δ⇒δ'}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{SNI} \AgdaBound{ε} \AgdaBound{SNε}\AgdaSymbol{))} \<[33]%
\>[33]\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{(λ} \AgdaBound{ε'} \AgdaBound{ε⇒ε'} \AgdaSymbol{→} \AgdaFunction{WTEaux} \AgdaBound{ψ}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaBound{Γ,p∶φ⊢δ∶ψ} \<[14]%
\>[14]\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{(}\AgdaFunction{subject-reduction} \AgdaBound{Γ⊢ε∶φ} \AgdaBound{ε⇒ε'}\AgdaSymbol{)} \<[35]%
\>[35]\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{(}\AgdaFunction{C-red} \AgdaBound{ψ} \AgdaSymbol{\{}\AgdaBound{δ} \AgdaFunction{⟦} \AgdaFunction{x₀:=} \AgdaBound{ε} \AgdaFunction{⟧}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{δ} \AgdaFunction{⟦} \AgdaFunction{x₀:=} \AgdaBound{ε'} \AgdaFunction{⟧}\AgdaSymbol{\}} \AgdaBound{δ[p∶=ε]∈CΓψ} \AgdaSymbol{(}\AgdaFunction{apredl} \AgdaFunction{SUB} \AgdaSymbol{\{}\AgdaArgument{E} \AgdaSymbol{=} \AgdaBound{δ}\AgdaSymbol{\}} \AgdaFunction{β-respects-sub} \AgdaSymbol{(}\AgdaFunction{botsub-red} \AgdaBound{ε⇒ε'}\AgdaSymbol{)))} \<[111]%
\>[111]\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{(}\AgdaInductiveConstructor{SNI} \AgdaBound{δ} \AgdaBound{SNδ}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{SNε} \AgdaSymbol{\_} \AgdaBound{ε⇒ε'}\AgdaSymbol{)))}\<%
\end{code}
}

\begin{code}%
\>\AgdaFunction{WTE} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Context} \AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{φ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{δ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{ψ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{ε}\AgdaSymbol{\}} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaBound{Γ} \AgdaFunction{,P} \AgdaBound{φ} \AgdaDatatype{⊢} \AgdaBound{δ} \AgdaDatatype{∶} \AgdaBound{ψ} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaBound{Γ} \AgdaDatatype{⊢} \AgdaBound{ε} \AgdaDatatype{∶} \AgdaBound{φ} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{C} \AgdaBound{Γ} \AgdaBound{ψ} \AgdaSymbol{(}\AgdaBound{δ} \AgdaFunction{⟦} \AgdaFunction{x₀:=} \AgdaBound{ε} \AgdaFunction{⟧}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaDatatype{SN} \AgdaBound{ε} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{C} \AgdaBound{Γ} \AgdaBound{ψ} \AgdaSymbol{(}\AgdaFunction{appP} \AgdaSymbol{(}\AgdaFunction{ΛP} \AgdaBound{φ} \AgdaBound{δ}\AgdaSymbol{)} \AgdaBound{ε}\AgdaSymbol{)}\<%
\end{code}

\AgdaHide{
\begin{code}%
\>\AgdaFunction{WTE} \AgdaSymbol{\{}\AgdaArgument{ψ} \AgdaSymbol{=} \AgdaBound{ψ}\AgdaSymbol{\}} \AgdaBound{Γ,p∶φ⊢δ∶ψ} \AgdaBound{Γ⊢ε∶φ} \AgdaBound{δ[p∶=ε]∈CΓψ} \AgdaSymbol{=} \AgdaFunction{WTEaux} \AgdaBound{ψ} \AgdaBound{Γ,p∶φ⊢δ∶ψ} \AgdaBound{Γ⊢ε∶φ} \AgdaBound{δ[p∶=ε]∈CΓψ} \AgdaSymbol{(}\AgdaFunction{SNap'} \AgdaSymbol{\{}\AgdaFunction{SUB}\AgdaSymbol{\}} \AgdaFunction{β-respects-sub} \AgdaSymbol{(}\AgdaFunction{CsubSN} \AgdaBound{ψ} \AgdaBound{δ[p∶=ε]∈CΓψ}\AgdaSymbol{))}\<%
\end{code}
}

\begin{lm}
If $\delta \in C_\Gamma(\phi \rightarrow \psi)$ and $\epsilon \in C_\Gamma(\phi)$ then $\delta \epsilon \in C_\Gamma(\psi)$.
\end{lm}

\begin{code}%
\>\AgdaFunction{C-app} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Context} \AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{δ} \AgdaBound{ε} \AgdaBound{φ} \AgdaBound{ψ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{C} \AgdaBound{Γ} \AgdaSymbol{(}\AgdaBound{φ} \AgdaInductiveConstructor{⇛} \AgdaBound{ψ}\AgdaSymbol{)} \AgdaBound{δ} \AgdaSymbol{→} \AgdaFunction{C} \AgdaBound{Γ} \AgdaBound{φ} \AgdaBound{ε} \AgdaSymbol{→} \AgdaFunction{C} \AgdaBound{Γ} \AgdaBound{ψ} \AgdaSymbol{(}\AgdaFunction{appP} \AgdaBound{δ} \AgdaBound{ε}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{C-app} \AgdaSymbol{\{}\AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{δ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{ε}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{φ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{ψ}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaBound{Γ⊢δ∶φ⇛ψ} \AgdaInductiveConstructor{,p} \AgdaBound{δ∈CΓφ⇛ψ}\AgdaSymbol{)} \AgdaBound{ε∈CΓφ} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{subst} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaFunction{C} \AgdaBound{Γ} \AgdaBound{ψ} \AgdaSymbol{(}\AgdaFunction{appP} \AgdaBound{x} \AgdaBound{ε}\AgdaSymbol{))} \AgdaFunction{ap-idRep} \AgdaSymbol{(}\AgdaBound{δ∈CΓφ⇛ψ} \AgdaBound{P} \AgdaSymbol{(}\AgdaFunction{idRep} \AgdaBound{P}\AgdaSymbol{)} \AgdaBound{ε} \AgdaFunction{idRep-typed} \AgdaBound{ε∈CΓφ}\AgdaSymbol{)}\<%
\end{code}

A substitution $\sigma$ is a \emph{computable} substitution from $\Gamma$ to $\Delta$, $\sigma : \Gamma \rightarrow_C \Delta$,
iff for all $p : \phi \in \Gamma$ we have $\sigma(p) \in C_\Delta(\phi)$.

\begin{code}%
\>\AgdaFunction{\_∶\_⇒C\_} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Q}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{Sub} \AgdaBound{P} \AgdaBound{Q} \AgdaSymbol{→} \AgdaDatatype{Context} \AgdaBound{P} \AgdaSymbol{→} \AgdaDatatype{Context} \AgdaBound{Q} \AgdaSymbol{→} \AgdaPrimitiveType{Set}\<%
\\
\>\AgdaBound{σ} \AgdaFunction{∶} \AgdaBound{Γ} \AgdaFunction{⇒C} \AgdaBound{Δ} \AgdaSymbol{=} \AgdaSymbol{∀} \AgdaBound{x} \AgdaSymbol{→} \AgdaFunction{C} \AgdaBound{Δ} \AgdaSymbol{(}\AgdaFunction{unprp} \AgdaSymbol{(}\AgdaFunction{typeof} \AgdaSymbol{\{}\AgdaArgument{K} \AgdaSymbol{=} \AgdaInductiveConstructor{-proof}\AgdaSymbol{\}} \AgdaBound{x} \AgdaBound{Γ}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaBound{σ} \AgdaSymbol{\_} \AgdaBound{x}\AgdaSymbol{)}\<%
\end{code}

\begin{prop}
If $\sigma : \Gamma \rightarrow_C \Delta$ then $\sigma : \Gamma \rightarrow \Delta$.
\end{prop}

\begin{code}%
\>\AgdaFunction{SubC-typed} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{P} \AgdaBound{Q}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ} \AgdaSymbol{:} \AgdaFunction{Sub} \AgdaBound{P} \AgdaBound{Q}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{σ} \AgdaFunction{∶} \AgdaBound{Γ} \AgdaFunction{⇒C} \AgdaBound{Δ} \AgdaSymbol{→} \AgdaBound{σ} \AgdaFunction{∶} \AgdaBound{Γ} \AgdaFunction{⇒} \AgdaBound{Δ}\<%
\\
\>\AgdaFunction{SubC-typed} \AgdaBound{σ∶Γ⇒CΔ} \AgdaBound{x} \AgdaSymbol{=} \AgdaFunction{C-typed} \AgdaSymbol{(}\AgdaBound{σ∶Γ⇒CΔ} \AgdaBound{x}\AgdaSymbol{)}\<%
\end{code}

\begin{prop}
If $\Gamma \vdash \delta : \phi$ and $\sigma : \Gamma \rightarrow_C \Delta$ then $\delta [ \sigma ] \in C_\Delta(\phi)$.
\end{prop}

\begin{code}%
\>\AgdaFunction{compRSC} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Q}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{R}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{\{}\AgdaBound{ρ} \AgdaSymbol{:} \AgdaFunction{Rep} \AgdaBound{Q} \AgdaBound{R}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ} \AgdaSymbol{:} \AgdaFunction{Sub} \AgdaBound{P} \AgdaBound{Q}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Context} \AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Context} \AgdaBound{Q}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Θ} \AgdaSymbol{:} \AgdaDatatype{Context} \AgdaBound{R}\AgdaSymbol{\}} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaBound{ρ} \AgdaFunction{∶} \AgdaBound{Δ} \AgdaFunction{⇒R} \AgdaBound{Θ} \AgdaSymbol{→} \AgdaBound{σ} \AgdaFunction{∶} \AgdaBound{Γ} \AgdaFunction{⇒C} \AgdaBound{Δ} \AgdaSymbol{→} \AgdaBound{ρ} \AgdaFunction{•RS} \AgdaBound{σ} \AgdaFunction{∶} \AgdaBound{Γ} \AgdaFunction{⇒C} \AgdaBound{Θ}\<%
\\
\>\AgdaFunction{compRSC} \AgdaSymbol{\{}\AgdaArgument{Γ} \AgdaSymbol{=} \AgdaBound{Γ}\AgdaSymbol{\}} \AgdaBound{ρ∶Δ⇒RΘ} \AgdaBound{σ∶Γ⇒CΔ} \AgdaBound{x} \AgdaSymbol{=} \<[34]%
\>[34]\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{C-rep} \AgdaSymbol{(}\AgdaFunction{unprp} \AgdaSymbol{(}\AgdaFunction{typeof} \AgdaBound{x} \AgdaBound{Γ}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaBound{σ∶Γ⇒CΔ} \AgdaBound{x}\AgdaSymbol{)} \AgdaBound{ρ∶Δ⇒RΘ}\<%
\\
%
\\
\>\AgdaFunction{extend-sub} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Q}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ} \AgdaSymbol{:} \AgdaFunction{Sub} \AgdaBound{P} \AgdaBound{Q}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Δ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{δ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{φ}\AgdaSymbol{\}} \AgdaSymbol{→}\<%
\\
\>[6]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaBound{σ} \AgdaFunction{∶} \AgdaBound{Γ} \AgdaFunction{⇒C} \AgdaBound{Δ} \AgdaSymbol{→} \AgdaFunction{C} \AgdaBound{Δ} \AgdaBound{φ} \AgdaBound{δ} \AgdaSymbol{→} \AgdaFunction{x₀:=} \AgdaBound{δ} \AgdaFunction{•} \AgdaFunction{liftSub} \AgdaSymbol{\_} \AgdaBound{σ} \AgdaFunction{∶} \AgdaBound{Γ} \AgdaFunction{,P} \AgdaBound{φ} \AgdaFunction{⇒C} \AgdaBound{Δ}\<%
\\
\>\AgdaFunction{extend-sub} \AgdaBound{σ∶Γ⇒CΔ} \AgdaBound{δ∈CΔφ} \AgdaInductiveConstructor{x₀} \AgdaSymbol{=} \AgdaBound{δ∈CΔφ}\<%
\\
\>\AgdaFunction{extend-sub} \AgdaSymbol{\{}\AgdaArgument{σ} \AgdaSymbol{=} \AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaArgument{Δ} \AgdaSymbol{=} \AgdaBound{Δ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{δ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{φ}\AgdaSymbol{\}} \AgdaBound{σ∶Γ⇒CΔ} \AgdaBound{δ∈CΔφ} \AgdaSymbol{(}\AgdaInductiveConstructor{↑} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{let} \AgdaBound{σx∈CΔφ} \AgdaSymbol{:} \AgdaFunction{C} \AgdaBound{Δ} \AgdaSymbol{(}\AgdaFunction{unprp} \AgdaSymbol{(}\AgdaFunction{typeof} \AgdaBound{x} \AgdaBound{Γ}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaBound{σ} \AgdaSymbol{\_} \AgdaBound{x}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaBound{σx∈CΔφ} \AgdaSymbol{=} \AgdaBound{σ∶Γ⇒CΔ} \AgdaBound{x} \AgdaKeyword{in}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{subst₂} \AgdaSymbol{(}\AgdaFunction{C} \AgdaBound{Δ}\AgdaSymbol{)} \<[15]%
\>[15]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{(}\AgdaKeyword{let} \AgdaKeyword{open} \AgdaModule{≡-Reasoning} \AgdaKeyword{in}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{begin}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{unprp} \AgdaSymbol{(}\AgdaFunction{typeof} \AgdaBound{x} \AgdaBound{Γ}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨⟨} \AgdaFunction{unprp-rep} \AgdaSymbol{(}\AgdaFunction{typeof} \AgdaBound{x} \AgdaBound{Γ}\AgdaSymbol{)} \AgdaFunction{upRep} \AgdaFunction{⟩⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{unprp} \AgdaSymbol{(}\AgdaFunction{typeof} \AgdaBound{x} \AgdaBound{Γ} \AgdaFunction{⇑}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{∎}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaKeyword{let} \AgdaKeyword{open} \AgdaModule{≡-Reasoning} \AgdaKeyword{in}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{begin}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaBound{σ} \AgdaSymbol{\_} \AgdaBound{x}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨⟨} \AgdaFunction{botSub-upRep} \AgdaSymbol{(}\AgdaBound{σ} \AgdaSymbol{\_} \AgdaBound{x}\AgdaSymbol{)} \AgdaFunction{⟩⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaBound{σ} \AgdaSymbol{\_} \AgdaBound{x} \AgdaFunction{⇑} \AgdaFunction{⟦} \AgdaFunction{x₀:=} \AgdaBound{δ} \AgdaFunction{⟧}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{∎}\AgdaSymbol{)} \AgdaBound{σx∈CΔφ}\<%
\\
%
\\
\>\AgdaFunction{SNmainlemma} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Q}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Context} \AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{δ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{φ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ} \AgdaSymbol{:} \AgdaFunction{Sub} \AgdaBound{P} \AgdaBound{Q}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Δ}\AgdaSymbol{\}} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaBound{Γ} \AgdaDatatype{⊢} \AgdaBound{δ} \AgdaDatatype{∶} \AgdaBound{φ} \AgdaSymbol{→} \AgdaBound{σ} \AgdaFunction{∶} \AgdaBound{Γ} \AgdaFunction{⇒C} \AgdaBound{Δ} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{C} \AgdaBound{Δ} \AgdaBound{φ} \AgdaSymbol{(}\AgdaBound{δ} \AgdaFunction{⟦} \AgdaBound{σ} \AgdaFunction{⟧}\AgdaSymbol{)}\<%
\end{code}

\AgdaHide{
\begin{code}%
\>\AgdaComment{--TODO Tidy up}\<%
\\
\>\AgdaFunction{SNmainlemma} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaBound{p}\AgdaSymbol{)} \AgdaBound{σ∶Γ⇒CΔ} \AgdaSymbol{=} \AgdaBound{σ∶Γ⇒CΔ} \AgdaBound{p}\<%
\\
\>\AgdaFunction{SNmainlemma} \AgdaSymbol{(}\AgdaInductiveConstructor{app} \AgdaBound{Γ⊢δ∶φ⇛ψ} \AgdaBound{Γ⊢ε∶φ}\AgdaSymbol{)} \AgdaBound{σ∶Γ⇒CΔ} \AgdaSymbol{=} \<[41]%
\>[41]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{C-app} \AgdaSymbol{(}\AgdaFunction{SNmainlemma} \AgdaBound{Γ⊢δ∶φ⇛ψ} \AgdaBound{σ∶Γ⇒CΔ}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{SNmainlemma} \AgdaBound{Γ⊢ε∶φ} \AgdaBound{σ∶Γ⇒CΔ}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{SNmainlemma} \AgdaSymbol{\{}\AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaArgument{Γ} \AgdaSymbol{=} \AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaArgument{σ} \AgdaSymbol{=} \AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Δ}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{Λ} \AgdaSymbol{\{}\AgdaArgument{φ} \AgdaSymbol{=} \AgdaBound{φ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaArgument{δ} \AgdaSymbol{=} \AgdaBound{δ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{ψ}\AgdaSymbol{\}} \AgdaBound{Γ,φ⊢δ∶ψ}\AgdaSymbol{)} \AgdaBound{σ∶Γ⇒CΔ} \AgdaSymbol{=} \AgdaSymbol{(}\AgdaFunction{substitution} \AgdaSymbol{(}\AgdaInductiveConstructor{Λ} \AgdaBound{Γ,φ⊢δ∶ψ}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{SubC-typed} \AgdaSymbol{\{}\AgdaArgument{σ} \AgdaSymbol{=} \AgdaBound{σ}\AgdaSymbol{\}} \AgdaBound{σ∶Γ⇒CΔ}\AgdaSymbol{))} \AgdaInductiveConstructor{,p} \<[135]%
\>[135]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{(λ} \AgdaBound{R} \AgdaSymbol{\{}\AgdaBound{Θ}\AgdaSymbol{\}} \AgdaBound{ρ} \AgdaBound{ε} \AgdaBound{ρ∶Δ⇒RΘ} \AgdaBound{ε∈CΘφ} \AgdaSymbol{→} \<[30]%
\>[30]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaKeyword{let} \AgdaBound{δσ[ε]∈CΘψ} \AgdaSymbol{:} \AgdaFunction{C} \AgdaBound{Θ} \AgdaBound{ψ} \AgdaSymbol{(}\AgdaBound{δ} \AgdaFunction{⟦} \AgdaFunction{liftSub} \AgdaSymbol{\_} \AgdaBound{σ} \AgdaFunction{⟧} \AgdaFunction{〈} \AgdaFunction{liftRep} \AgdaSymbol{\_} \AgdaBound{ρ} \AgdaFunction{〉} \AgdaFunction{⟦} \AgdaFunction{x₀:=} \AgdaBound{ε} \AgdaFunction{⟧}\AgdaSymbol{)}\<%
\\
\>[4]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaBound{δσ[ε]∈CΘψ} \AgdaSymbol{=} \AgdaFunction{subst} \AgdaSymbol{(}\AgdaFunction{C} \AgdaBound{Θ} \AgdaBound{ψ}\AgdaSymbol{)} \<[34]%
\>[34]\<%
\\
\>[8]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{(}\AgdaKeyword{let} \AgdaKeyword{open} \AgdaModule{≡-Reasoning} \AgdaKeyword{in}\<%
\\
\>[10]\AgdaIndent{12}{}\<[12]%
\>[12]\AgdaBound{δ} \AgdaFunction{⟦} \AgdaFunction{x₀:=} \AgdaBound{ε} \AgdaFunction{•} \AgdaFunction{liftSub} \AgdaSymbol{\_} \AgdaSymbol{(}\AgdaBound{ρ} \AgdaFunction{•RS} \AgdaBound{σ}\AgdaSymbol{)} \AgdaFunction{⟧}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaFunction{≡⟨} \AgdaFunction{sub-comp} \AgdaBound{δ} \AgdaFunction{⟩}\<%
\\
\>[10]\AgdaIndent{12}{}\<[12]%
\>[12]\AgdaBound{δ} \AgdaFunction{⟦} \AgdaFunction{liftSub} \AgdaSymbol{\_} \AgdaSymbol{(}\AgdaBound{ρ} \AgdaFunction{•RS} \AgdaBound{σ}\AgdaSymbol{)} \AgdaFunction{⟧} \AgdaFunction{⟦} \AgdaFunction{x₀:=} \AgdaBound{ε} \AgdaFunction{⟧}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaFunction{≡⟨} \AgdaFunction{sub-congl} \AgdaSymbol{(}\AgdaFunction{sub-congr} \AgdaFunction{liftSub-compRS} \AgdaBound{δ}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[10]\AgdaIndent{12}{}\<[12]%
\>[12]\AgdaBound{δ} \AgdaFunction{⟦} \AgdaFunction{liftRep} \AgdaSymbol{\_} \AgdaBound{ρ} \AgdaFunction{•RS} \AgdaFunction{liftSub} \AgdaSymbol{\_} \AgdaBound{σ} \AgdaFunction{⟧} \AgdaFunction{⟦} \AgdaFunction{x₀:=} \AgdaBound{ε} \AgdaFunction{⟧}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaFunction{≡⟨} \AgdaFunction{sub-congl} \AgdaSymbol{(}\AgdaFunction{sub-compRS} \AgdaBound{δ}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[10]\AgdaIndent{12}{}\<[12]%
\>[12]\AgdaBound{δ} \AgdaFunction{⟦} \AgdaFunction{liftSub} \AgdaSymbol{\_} \AgdaBound{σ} \AgdaFunction{⟧} \AgdaFunction{〈} \AgdaFunction{liftRep} \AgdaSymbol{\_} \AgdaBound{ρ} \AgdaFunction{〉} \AgdaFunction{⟦} \AgdaFunction{x₀:=} \AgdaBound{ε} \AgdaFunction{⟧}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaFunction{∎}\AgdaSymbol{)} \<[13]%
\>[13]\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{(}\AgdaFunction{SNmainlemma} \AgdaBound{Γ,φ⊢δ∶ψ} \AgdaSymbol{(}\AgdaFunction{extend-sub} \AgdaSymbol{(}\AgdaFunction{compRSC} \AgdaSymbol{\{}\AgdaArgument{σ} \AgdaSymbol{=} \AgdaBound{σ}\AgdaSymbol{\}} \AgdaBound{ρ∶Δ⇒RΘ} \AgdaBound{σ∶Γ⇒CΔ}\AgdaSymbol{)} \AgdaBound{ε∈CΘφ}\AgdaSymbol{))} \AgdaKeyword{in}\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaFunction{WTE} \AgdaSymbol{\{}\AgdaBound{R}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Θ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{φ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{δ} \AgdaFunction{⟦} \AgdaFunction{liftSub} \AgdaSymbol{\_} \AgdaBound{σ} \AgdaFunction{⟧} \AgdaFunction{〈} \AgdaFunction{liftRep} \AgdaSymbol{\_} \AgdaBound{ρ} \AgdaFunction{〉}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{ψ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{ε}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{(}\AgdaFunction{weakening} \AgdaSymbol{(}\AgdaFunction{substitution} \AgdaBound{Γ,φ⊢δ∶ψ} \AgdaSymbol{(}\AgdaFunction{liftSub-typed} \AgdaSymbol{(}\AgdaFunction{SubC-typed} \AgdaSymbol{\{}\AgdaArgument{σ} \AgdaSymbol{=} \AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Δ}\AgdaSymbol{\}} \AgdaBound{σ∶Γ⇒CΔ}\AgdaSymbol{)))} \AgdaSymbol{(}\AgdaFunction{liftRep-typed} \AgdaBound{ρ∶Δ⇒RΘ}\AgdaSymbol{))} \<[118]%
\>[118]\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{(}\AgdaFunction{C-typed} \AgdaBound{ε∈CΘφ}\AgdaSymbol{)} \<[24]%
\>[24]\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaBound{δσ[ε]∈CΘψ} \<[18]%
\>[18]\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{(}\AgdaFunction{CsubSN} \AgdaBound{φ} \AgdaBound{ε∈CΘφ}\AgdaSymbol{))}\<%
\end{code}
}

\begin{theorem}
Propositional Logic is strongly normalizing.
\end{theorem}

\begin{code}%
\>\AgdaFunction{Strong-Normalization} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Context} \AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{δ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{φ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{Γ} \AgdaDatatype{⊢} \AgdaBound{δ} \AgdaDatatype{∶} \AgdaBound{φ} \AgdaSymbol{→} \AgdaDatatype{SN} \AgdaBound{δ}\<%
\end{code}

\AgdaHide{
\begin{code}%
\>\AgdaFunction{Strong-Normalization} \AgdaSymbol{\{}\AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{δ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{φ}\AgdaSymbol{\}} \AgdaBound{Γ⊢δ:φ} \AgdaSymbol{=} \AgdaFunction{subst} \AgdaDatatype{SN} \<[54]%
\>[54]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{sub-idOp} \<[11]%
\>[11]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{(}\AgdaFunction{CsubSN} \AgdaSymbol{(}\AgdaBound{φ}\AgdaSymbol{)} \AgdaSymbol{\{}\AgdaBound{δ} \AgdaFunction{⟦} \AgdaFunction{idSub} \AgdaBound{P} \AgdaFunction{⟧}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{(}\AgdaFunction{SNmainlemma} \AgdaBound{Γ⊢δ:φ} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaFunction{varC} \AgdaSymbol{\{}\AgdaArgument{x} \AgdaSymbol{=} \AgdaBound{x}\AgdaSymbol{\})))}\<%
\end{code}
}
