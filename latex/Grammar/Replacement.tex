\AgdaHide{
\begin{code}%
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Grammar.Base}\<%
\\
%
\\
\>\AgdaKeyword{module} \AgdaModule{Grammar.Replacement} \AgdaSymbol{(}\AgdaBound{G} \AgdaSymbol{:} \AgdaRecord{Grammar}\AgdaSymbol{)} \AgdaKeyword{where}\<%
\\
%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Function}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Prelims}\<%
\\
\>\AgdaKeyword{open} \AgdaModule{Grammar} \AgdaBound{G}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Grammar.OpFamily.PreOpFamily} \AgdaBound{G}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Grammar.OpFamily.LiftFamily} \AgdaBound{G}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Grammar.OpFamily.OpFamily} \AgdaBound{G}\<%
\end{code}
}

\subsection{Replacement}

The operation family of \emph{replacement} is defined as follows.  A replacement $\rho : U \rightarrow V$ is a function
that maps every variable in $U$ to a variable in $V$ of the same kind.  Application, identity and composition are simply
function application, the identity function and function composition.  The successor is the canonical injection $V \rightarrow (V, K)$,
and $(\sigma , K)$ is the extension of $\sigma$ that maps $x_0$ to $x_0$.

\begin{code}%
\>\AgdaFunction{Rep} \AgdaSymbol{:} \AgdaDatatype{Alphabet} \AgdaSymbol{→} \AgdaDatatype{Alphabet} \AgdaSymbol{→} \AgdaPrimitiveType{Set}\<%
\\
\>\AgdaFunction{Rep} \AgdaBound{U} \AgdaBound{V} \AgdaSymbol{=} \AgdaSymbol{∀} \AgdaBound{K} \AgdaSymbol{→} \AgdaDatatype{Var} \AgdaBound{U} \AgdaBound{K} \AgdaSymbol{→} \AgdaDatatype{Var} \AgdaBound{V} \AgdaBound{K}\<%
\\
%
\\
\>\AgdaFunction{rep↑} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{U}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V}\AgdaSymbol{\}} \AgdaBound{K} \AgdaSymbol{→} \AgdaFunction{Rep} \AgdaBound{U} \AgdaBound{V} \AgdaSymbol{→} \AgdaFunction{Rep} \AgdaSymbol{(}\AgdaBound{U} \AgdaInductiveConstructor{,} \AgdaBound{K}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{V} \AgdaInductiveConstructor{,} \AgdaBound{K}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{rep↑} \AgdaSymbol{\_} \AgdaSymbol{\_} \AgdaSymbol{\_} \AgdaInductiveConstructor{x₀} \AgdaSymbol{=} \AgdaInductiveConstructor{x₀}\<%
\\
\>\AgdaFunction{rep↑} \AgdaSymbol{\_} \AgdaBound{ρ} \AgdaBound{K} \AgdaSymbol{(}\AgdaInductiveConstructor{↑} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{↑} \AgdaSymbol{(}\AgdaBound{ρ} \AgdaBound{K} \AgdaBound{x}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{upRep} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{K}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{Rep} \AgdaBound{V} \AgdaSymbol{(}\AgdaBound{V} \AgdaInductiveConstructor{,} \AgdaBound{K}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{upRep} \AgdaSymbol{\_} \AgdaSymbol{=} \AgdaInductiveConstructor{↑}\<%
\\
%
\\
\>\AgdaFunction{idRep} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaBound{V} \AgdaSymbol{→} \AgdaFunction{Rep} \AgdaBound{V} \AgdaBound{V}\<%
\\
\>\AgdaFunction{idRep} \AgdaSymbol{\_} \AgdaSymbol{\_} \AgdaBound{x} \AgdaSymbol{=} \AgdaBound{x}\<%
\\
%
\\
\>\AgdaFunction{pre-replacement} \AgdaSymbol{:} \AgdaRecord{PreOpFamily}\<%
\\
\>\AgdaFunction{pre-replacement} \AgdaSymbol{=} \AgdaKeyword{record} \AgdaSymbol{\{} \<[27]%
\>[27]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaField{Op} \AgdaSymbol{=} \AgdaFunction{Rep}\AgdaSymbol{;} \<[12]%
\>[12]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaField{apV} \AgdaSymbol{=} \AgdaSymbol{λ} \AgdaBound{ρ} \AgdaBound{x} \AgdaSymbol{→} \AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaBound{ρ} \AgdaSymbol{\_} \AgdaBound{x}\AgdaSymbol{);} \<[29]%
\>[29]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaField{up} \AgdaSymbol{=} \AgdaFunction{upRep}\AgdaSymbol{;} \<[14]%
\>[14]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaField{apV-up} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\AgdaSymbol{;} \<[17]%
\>[17]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaField{idOp} \AgdaSymbol{=} \AgdaFunction{idRep}\AgdaSymbol{;} \<[16]%
\>[16]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaField{apV-idOp} \AgdaSymbol{=} \AgdaSymbol{λ} \AgdaBound{\_} \AgdaSymbol{→} \AgdaInductiveConstructor{refl} \AgdaSymbol{\}}\<%
\\
%
\\
\>\AgdaFunction{\_∼R\_} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{U}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{Rep} \AgdaBound{U} \AgdaBound{V} \AgdaSymbol{→} \AgdaFunction{Rep} \AgdaBound{U} \AgdaBound{V} \AgdaSymbol{→} \AgdaPrimitiveType{Set}\<%
\\
\>\AgdaFunction{\_∼R\_} \AgdaSymbol{=} \AgdaFunction{PreOpFamily.\_∼op\_} \AgdaFunction{pre-replacement}\<%
\\
%
\\
\>\AgdaFunction{rep↑-cong} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{U}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{K}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{ρ} \AgdaBound{ρ'} \AgdaSymbol{:} \AgdaFunction{Rep} \AgdaBound{U} \AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{→} \<[45]%
\>[45]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaBound{ρ} \AgdaFunction{∼R} \AgdaBound{ρ'} \AgdaSymbol{→} \AgdaFunction{rep↑} \AgdaBound{K} \AgdaBound{ρ} \AgdaFunction{∼R} \AgdaFunction{rep↑} \AgdaBound{K} \AgdaBound{ρ'}\<%
\end{code}

\AgdaHide{
\begin{code}%
\>\AgdaFunction{rep↑-cong} \AgdaBound{ρ-is-ρ'} \AgdaInductiveConstructor{x₀} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{rep↑-cong} \AgdaBound{ρ-is-ρ'} \AgdaSymbol{(}\AgdaInductiveConstructor{↑} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{cong} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaFunction{∘} \AgdaInductiveConstructor{↑}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{var-inj} \AgdaSymbol{(}\AgdaBound{ρ-is-ρ'} \AgdaBound{x}\AgdaSymbol{))}\<%
\end{code}
}

\begin{code}%
\>\AgdaFunction{proto-replacement} \AgdaSymbol{:} \AgdaRecord{LiftFamily}\<%
\\
\>\AgdaFunction{proto-replacement} \AgdaSymbol{=} \AgdaKeyword{record} \AgdaSymbol{\{} \<[29]%
\>[29]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaField{preOpFamily} \AgdaSymbol{=} \AgdaFunction{pre-replacement} \AgdaSymbol{;} \<[34]%
\>[34]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaField{lifting} \AgdaSymbol{=} \AgdaKeyword{record} \AgdaSymbol{\{} \<[21]%
\>[21]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{liftOp} \AgdaSymbol{=} \AgdaFunction{rep↑} \AgdaSymbol{;} \<[20]%
\>[20]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{liftOp-cong} \AgdaSymbol{=} \AgdaFunction{rep↑-cong} \AgdaSymbol{\}} \AgdaSymbol{;} \<[32]%
\>[32]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaField{isLiftFamily} \AgdaSymbol{=} \AgdaKeyword{record} \AgdaSymbol{\{} \<[26]%
\>[26]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{liftOp-x₀} \AgdaSymbol{=} \AgdaInductiveConstructor{refl} \AgdaSymbol{;} \<[23]%
\>[23]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{liftOp-↑} \AgdaSymbol{=} \AgdaSymbol{λ} \AgdaBound{\_} \AgdaSymbol{→} \AgdaInductiveConstructor{refl} \AgdaSymbol{\}} \AgdaSymbol{\}}\<%
\\
%
\\
\>\AgdaKeyword{infix} \AgdaNumber{70} \AgdaFixityOp{\_〈\_〉}\<%
\\
\>\AgdaFunction{\_〈\_〉} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{U}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{C}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{K}\AgdaSymbol{\}} \AgdaSymbol{→} \<[27]%
\>[27]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaDatatype{Subexpression} \AgdaBound{U} \AgdaBound{C} \AgdaBound{K} \AgdaSymbol{→} \AgdaFunction{Rep} \AgdaBound{U} \AgdaBound{V} \AgdaSymbol{→} \AgdaDatatype{Subexpression} \AgdaBound{V} \AgdaBound{C} \AgdaBound{K}\<%
\\
\>\AgdaBound{E} \AgdaFunction{〈} \AgdaBound{ρ} \AgdaFunction{〉} \AgdaSymbol{=} \AgdaFunction{LiftFamily.ap} \AgdaFunction{proto-replacement} \AgdaBound{ρ} \AgdaBound{E}\<%
\\
%
\\
\>\AgdaKeyword{infixl} \AgdaNumber{75} \AgdaFixityOp{\_•R\_}\<%
\\
\>\AgdaFunction{\_•R\_} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{U}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{W}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{Rep} \AgdaBound{V} \AgdaBound{W} \AgdaSymbol{→} \AgdaFunction{Rep} \AgdaBound{U} \AgdaBound{V} \AgdaSymbol{→} \AgdaFunction{Rep} \AgdaBound{U} \AgdaBound{W}\<%
\\
\>\AgdaSymbol{(}\AgdaBound{ρ'} \AgdaFunction{•R} \AgdaBound{ρ}\AgdaSymbol{)} \AgdaBound{K} \AgdaBound{x} \AgdaSymbol{=} \AgdaBound{ρ'} \AgdaBound{K} \AgdaSymbol{(}\AgdaBound{ρ} \AgdaBound{K} \AgdaBound{x}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{rep↑-comp} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{U}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{W}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{K}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{ρ'} \AgdaSymbol{:} \AgdaFunction{Rep} \AgdaBound{V} \AgdaBound{W}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{ρ} \AgdaSymbol{:} \AgdaFunction{Rep} \AgdaBound{U} \AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{→} \<[61]%
\>[61]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{rep↑} \AgdaBound{K} \AgdaSymbol{(}\AgdaBound{ρ'} \AgdaFunction{•R} \AgdaBound{ρ}\AgdaSymbol{)} \AgdaFunction{∼R} \AgdaFunction{rep↑} \AgdaBound{K} \AgdaBound{ρ'} \AgdaFunction{•R} \AgdaFunction{rep↑} \AgdaBound{K} \AgdaBound{ρ}\<%
\end{code}

\AgdaHide{
\begin{code}%
\>\AgdaFunction{rep↑-comp} \AgdaInductiveConstructor{x₀} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{rep↑-comp} \AgdaSymbol{(}\AgdaInductiveConstructor{↑} \AgdaSymbol{\_)} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\end{code}
}

\begin{code}%
\>\AgdaFunction{replacement} \AgdaSymbol{:} \AgdaRecord{OpFamily}\<%
\\
\>\AgdaFunction{replacement} \AgdaSymbol{=} \AgdaKeyword{record} \AgdaSymbol{\{} \<[23]%
\>[23]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaField{liftFamily} \AgdaSymbol{=} \AgdaFunction{proto-replacement} \AgdaSymbol{;} \<[35]%
\>[35]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaField{isOpFamily} \AgdaSymbol{=} \AgdaKeyword{record} \AgdaSymbol{\{} \<[24]%
\>[24]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{\_∘\_} \AgdaSymbol{=} \AgdaFunction{\_•R\_} \AgdaSymbol{;} \<[17]%
\>[17]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{apV-comp} \AgdaSymbol{=} \AgdaInductiveConstructor{refl} \AgdaSymbol{;} \<[22]%
\>[22]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{liftOp-comp} \AgdaSymbol{=} \AgdaFunction{rep↑-comp} \AgdaSymbol{\}} \AgdaSymbol{\}}\<%
\end{code}

\AgdaHide{
\begin{code}%
\>\AgdaKeyword{open} \AgdaModule{OpFamily} \AgdaFunction{replacement} \AgdaKeyword{public} \AgdaKeyword{using} \AgdaSymbol{()} \<[42]%
\>[42]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{renaming} \AgdaSymbol{(}ap-congl \AgdaSymbol{to} rep-congr\AgdaSymbol{;}\<\\
\>           ap-congr \AgdaSymbol{to} rep-congl\AgdaSymbol{;}\<\\
\>           ap-idOp \AgdaSymbol{to} rep-idOp\AgdaSymbol{;}\<\\
\>           ap-circ \AgdaSymbol{to} rep-comp\AgdaSymbol{;}\<\\
\>           liftOp-idOp \AgdaSymbol{to} rep↑-idOp\AgdaSymbol{;}\<\\
\>           liftOp-up' \AgdaSymbol{to} rep↑-upRep\AgdaSymbol{)}\<%
\end{code}
}

We write $E \uparrow$ for $E \langle \uparrow \rangle$.

\begin{code}%
\>\AgdaKeyword{infixl} \AgdaNumber{70} \AgdaFixityOp{\_⇑}\<%
\\
\>\AgdaFunction{\_⇑} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{K}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{C}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{L}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{Subexpression} \AgdaBound{V} \AgdaBound{C} \AgdaBound{L} \AgdaSymbol{→} \AgdaDatatype{Subexpression} \AgdaSymbol{(}\AgdaBound{V} \AgdaInductiveConstructor{,} \AgdaBound{K}\AgdaSymbol{)} \AgdaBound{C} \AgdaBound{L}\<%
\\
\>\AgdaBound{E} \AgdaFunction{⇑} \AgdaSymbol{=} \AgdaBound{E} \AgdaFunction{〈} \AgdaFunction{upRep} \AgdaFunction{〉}\<%
\end{code}

We define the unique replacement $\emptyset \rightarrow V$ for any V, and prove it unique:

\begin{code}%
\>\AgdaFunction{magic} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{Rep} \AgdaInductiveConstructor{∅} \AgdaBound{V}\<%
\\
\>\AgdaFunction{magic} \AgdaSymbol{\_} \AgdaSymbol{()}\<%
\\
%
\\
\>\AgdaFunction{magic-unique} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{ρ} \AgdaSymbol{:} \AgdaFunction{Rep} \AgdaInductiveConstructor{∅} \AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{ρ} \AgdaFunction{∼R} \AgdaFunction{magic}\<%
\end{code}

\AgdaHide{
\begin{code}%
\>\AgdaFunction{magic-unique} \AgdaSymbol{\{}\AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{ρ}\AgdaSymbol{\}} \AgdaSymbol{()}\<%
\end{code}
}

\begin{code}%
\>\AgdaFunction{magic-unique'} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{U}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{C}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{K}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{(}\AgdaBound{E} \AgdaSymbol{:} \AgdaDatatype{Subexpression} \AgdaInductiveConstructor{∅} \AgdaBound{C} \AgdaBound{K}\AgdaSymbol{)} \AgdaSymbol{\{}\AgdaBound{ρ} \AgdaSymbol{:} \AgdaFunction{Rep} \AgdaBound{U} \AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{→} \<[44]%
\>[44]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaBound{E} \AgdaFunction{〈} \AgdaFunction{magic} \AgdaFunction{〉} \AgdaFunction{〈} \AgdaBound{ρ} \AgdaFunction{〉} \AgdaDatatype{≡} \AgdaBound{E} \AgdaFunction{〈} \AgdaFunction{magic} \AgdaFunction{〉}\<%
\end{code}

\AgdaHide{
\begin{code}%
\>\AgdaFunction{magic-unique'} \AgdaBound{E} \AgdaSymbol{\{}\AgdaBound{ρ}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaKeyword{let} \AgdaKeyword{open} \AgdaModule{≡-Reasoning} \AgdaKeyword{in}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{begin}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaBound{E} \AgdaFunction{〈} \AgdaFunction{magic} \AgdaFunction{〉} \AgdaFunction{〈} \AgdaBound{ρ} \AgdaFunction{〉}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨⟨} \AgdaFunction{rep-comp} \AgdaBound{E} \AgdaFunction{⟩⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaBound{E} \AgdaFunction{〈} \AgdaBound{ρ} \AgdaFunction{•R} \AgdaFunction{magic} \AgdaFunction{〉}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{rep-congr} \AgdaBound{E} \AgdaSymbol{(}\AgdaFunction{magic-unique} \AgdaSymbol{\{}\AgdaArgument{ρ} \AgdaSymbol{=} \AgdaBound{ρ} \AgdaFunction{•R} \AgdaFunction{magic}\AgdaSymbol{\})} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaBound{E} \AgdaFunction{〈} \AgdaFunction{magic} \AgdaFunction{〉}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{∎}\<%
\\
%
\\
\>\AgdaFunction{rep↑-upRep₂} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{U}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{C}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{K}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{L}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaBound{E} \AgdaSymbol{:} \AgdaDatatype{Subexpression} \AgdaBound{U} \AgdaBound{C} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{\{}\AgdaBound{σ} \AgdaSymbol{:} \AgdaFunction{Rep} \AgdaBound{U} \AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{E} \AgdaFunction{⇑} \AgdaFunction{⇑} \AgdaFunction{〈} \AgdaFunction{rep↑} \AgdaBound{K} \AgdaSymbol{(}\AgdaFunction{rep↑} \AgdaBound{L} \AgdaBound{σ}\AgdaSymbol{)} \AgdaFunction{〉} \AgdaDatatype{≡} \AgdaBound{E} \AgdaFunction{〈} \AgdaBound{σ} \AgdaFunction{〉} \AgdaFunction{⇑} \AgdaFunction{⇑}\<%
\\
\>\AgdaFunction{rep↑-upRep₂} \AgdaSymbol{\{}\AgdaBound{U}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{C}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{K}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{L}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaBound{E} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaKeyword{let} \AgdaKeyword{open} \AgdaModule{≡-Reasoning} \AgdaKeyword{in} \<[68]%
\>[68]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{begin}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaBound{E} \AgdaFunction{⇑} \AgdaFunction{⇑} \AgdaFunction{〈} \AgdaFunction{rep↑} \AgdaBound{K} \AgdaSymbol{(}\AgdaFunction{rep↑} \AgdaBound{L} \AgdaBound{σ}\AgdaSymbol{)} \AgdaFunction{〉}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{rep↑-upRep} \AgdaSymbol{(}\AgdaBound{E} \AgdaFunction{⇑}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaBound{E} \AgdaFunction{⇑} \AgdaFunction{〈} \AgdaFunction{rep↑} \AgdaBound{L} \AgdaBound{σ} \AgdaFunction{〉} \AgdaFunction{⇑}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{rep-congl} \AgdaSymbol{(}\AgdaFunction{rep↑-upRep} \AgdaBound{E}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaBound{E} \AgdaFunction{〈} \AgdaBound{σ} \AgdaFunction{〉} \AgdaFunction{⇑} \AgdaFunction{⇑}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{∎}\<%
\\
%
\\
\>\AgdaFunction{rep↑-upRep₃} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{U}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{C}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{K}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{L}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{N}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaBound{E} \AgdaSymbol{:} \AgdaDatatype{Subexpression} \AgdaBound{U} \AgdaBound{C} \AgdaBound{N}\AgdaSymbol{)} \AgdaSymbol{\{}\AgdaBound{σ} \AgdaSymbol{:} \AgdaFunction{Rep} \AgdaBound{U} \AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{→} \<[86]%
\>[86]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaBound{E} \AgdaFunction{⇑} \AgdaFunction{⇑} \AgdaFunction{⇑} \AgdaFunction{〈} \AgdaFunction{rep↑} \AgdaBound{K} \AgdaSymbol{(}\AgdaFunction{rep↑} \AgdaBound{L} \AgdaSymbol{(}\AgdaFunction{rep↑} \AgdaBound{M} \AgdaBound{σ}\AgdaSymbol{))} \AgdaFunction{〉} \AgdaDatatype{≡} \AgdaBound{E} \AgdaFunction{〈} \AgdaBound{σ} \AgdaFunction{〉} \AgdaFunction{⇑} \AgdaFunction{⇑} \AgdaFunction{⇑}\<%
\\
\>\AgdaFunction{rep↑-upRep₃} \AgdaSymbol{\{}\AgdaBound{U}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{C}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{K}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{L}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaBound{E} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaKeyword{let} \AgdaKeyword{open} \AgdaModule{≡-Reasoning} \AgdaKeyword{in} \<[68]%
\>[68]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{begin}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaBound{E} \AgdaFunction{⇑} \AgdaFunction{⇑} \AgdaFunction{⇑} \AgdaFunction{〈} \AgdaFunction{rep↑} \AgdaBound{K} \AgdaSymbol{(}\AgdaFunction{rep↑} \AgdaBound{L} \AgdaSymbol{(}\AgdaFunction{rep↑} \AgdaBound{M} \AgdaBound{σ}\AgdaSymbol{))} \AgdaFunction{〉}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{rep↑-upRep₂} \AgdaSymbol{(}\AgdaBound{E} \AgdaFunction{⇑}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaBound{E} \AgdaFunction{⇑} \AgdaFunction{〈} \AgdaFunction{rep↑} \AgdaBound{M} \AgdaBound{σ} \AgdaFunction{〉} \AgdaFunction{⇑} \AgdaFunction{⇑}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{rep-congl} \AgdaSymbol{(}\AgdaFunction{rep-congl} \AgdaSymbol{(}\AgdaFunction{rep↑-upRep} \AgdaBound{E}\AgdaSymbol{))} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaBound{E} \AgdaFunction{〈} \AgdaBound{σ} \AgdaFunction{〉} \AgdaFunction{⇑} \AgdaFunction{⇑} \AgdaFunction{⇑}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{∎}\<%
\end{code}
}
