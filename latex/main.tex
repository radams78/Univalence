\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{autofe}
\usepackage{bbm}
\usepackage[greek,english]{babel}
\usepackage{etex}
\usepackage{framed}
\usepackage[utf8x]{inputenc}
\usepackage{proof}
\usepackage{stmaryrd}
\usepackage{suffix}
\usepackage{textalpha}
\usepackage{todo}
\usepackage{ucs}

\input{unicode}

\newtheorem{prop}[theorem]{Proposition}
\newtheorem{lm}[theorem]{Lemma}
\newtheorem{cor}{Corollary}[theorem]
\theoremstyle{definition}
\newtheorem{df}[theorem]{Definition}

\newcommand{\AgdaHide}[1]{}

\begin{document}

\maketitle

\begin{abstract}
    Homotopy type theory offers the promise of a formal system for the univalent foundations of mathematics. However, if we simply add the univalence axiom to type theory, then we lose the property of canonicity --- that every term computes to a normal form. A computation becomes `stuck' when it reaches the point that it needs to evaluate a proof term that is an application of the univalence axiom. So we wish to find a way to compute with the univalence axiom.

    As a first step, we present here a system of higher-order propositional logic, with a universe Omega of propositions closed under implication and quantification over any simple type over Omega. We add a type $M =_A N$ for any terms $M$, $N$ of type $A$, and two ways to prove an equality: reflexivity, and the univalence axiom. We present reduction relations for this system, and prove the reduction confluent and strongly normalizing on the well-typed terms. 
\end{abstract}

\section{Introduction}

The rules of deduction of a type theory are traditionally justified by a \emph{meaning explanation} \cite{ML:ITT}, in which to know that a given term has a given type is to know that it computes to a \emph{canonical object} of that type.  For such a meaning explanation to be possible, the type theory should have the following properties:
\begin{itemize}
\item \textbf{Confluence} --- The reduction relation should be confluent.
\item \textbf{Normalization} --- Every well-typed term should reduce to a normal form.
\item Every closed normal form of type $A$ is a canonical object of type $A$.
\end{itemize}
From these three properties, we have:
\begin{itemize}
\item \textbf{Canonicity} --- Every term of type $A$ reduces to a unique canonical object of type $A$.
\end{itemize}

It is desirable to have, in addition, \emph{strong normalization}, so that we know that we are free to choose whatever reduction strategy we please.

The \emph{univalence axiom} of Homotopy Type theory (HoTT) \cite{hottbook} breaks the property of canonicity.  It postulates a
constant
\[ \isotoid : A \simeq B \rightarrow A = B \]
that is an inverse to the canonical function $A = B \rightarrow A \simeq B$.  When a computation reaches a point
where we eliminate a path (proof of equality) formed by $\isotoid$, it gets 'stuck'.

As possible solutions to this problem, we may try to do with a weaker property than canonicity, such as \emph{propositional canonicity}.
We may attempt to prove that every closed term of type $\mathbb{N}$ is \emph{propositionally} equal to a numeral, as conjectured by Voevodsky.  Or we may attempt to change the definition of equality to make $\isotoid$ definable\cite{Polonsky14a}, or
shift to an entirely different type theory such as Cubical Type Theory\cite{cchm:cubical}.

We could also try a more conservative approach, and simply attempt to find a reduction relation for a type theory involving $\isotoid$ that satisfies
all three of the properties above.  There seems to be no reason \emph{a priori} to believe this is not possible, but it is difficult to do because
the full Homotopy Type Theory is a complex and interdependent system.  We can tackle the problem by adding univalence to a much simpler system, finding
a well-behaved reduction relation, then doing the same for more and more complex systems, gradually approaching the full strength of HoTT.

In this paper, we present a system we call $\lambda o e$, or predicative higher-order minimal logic.  It is a type theory with two universes: the universe $\Omega$
of \emph{propositions}, and the universe of \emph{types}.  The propositions are closed under $\supset$ (implication) and include $\bot$ (falsehood), and an equality proposition $M =_A N$ for
any type $A$ and terms $M : A$ and $N : A$.  The types include $\Omega$ itself and are closed under $\rightarrow$ (non-dependent function type).

There are two canonical forms for proofs of $M =_\Omega N$.  For any term $M : \Omega$, we have $\reff{M} : M =_\Omega M$.  We also add univalence for this system, in this form:
if $\delta : \phi \supset \psi$ and $\epsilon : \psi \supset\phi$, then $\univ{\phi}{\psi}{\delta}{\epsilon} : \phi =_\Omega \psi$.  

We present a reduction relation for this system, and prove it satisfies confluence (Corollary \ref{cor:confluence}), strong normalization (Corollary \ref{cor:SN}) and canonicity (Corollary \ref{cor:canon}).

For the future, we wish to expand the system with universal quantification, and expand it to a 2-dimensional system (with equations between proofs).

\section{Predicative Higher-Order Minimal Logic with Extensional Equality}

We call the following type theory $\lambda o e$, or \emph{predicative higher-order minimal logic with extensional equality}.  

\input{PHOPL/Grammar.tex}
\input{PHOPL/PathSub.tex}
%\input{PHOPL/Red.tex}
\input{PHOPL/Rules.tex}
\input{PHOPL/Meta.tex}
\input{PHOPL/KeyRedex2.tex}
\input{PHOPL/Computable.tex}
\input{PHOPL/SubC.tex}
\input{PHOPL/MainProp.tex}

%TODO Canonicity

% \section{$\lambda o i$}

% We further extend the system so that the equations are elements of $\Omega$.  This allows us, for example,
% to form propositions of the form $M =_A N \supset N =_A M$.

% The system $\lambda o i$ ($\lambda o$ with \emph{internal} equality) is defined as follows.  The
% syntax is formed by extending the grammar of $\lambda o$ with
% \[
% \begin{array}{lrcl}
% \text{Term} & M, \phi & ::= & \cdots \mid M =_A M \\
% \text{Proof} & \delta & ::= & \cdots \mid \reff{M} \mid \delta \supset^* \delta \mid \univ{\phi}{\phi}{\delta}{\delta} \mid \triplelambda^{MM} e : x =_A x . \delta \mid \delta_{MM} \delta\\
% & & & \quad \mid \delta =^*_A \delta \mid \delta^+ \mid \delta^-
% \end{array}
% \]

% Notice that we now tag the $\triplelambda$ proofs with two terms.

% The rules of deduction of $\lambda o i$ are those of Figures \ref{fig:lambdao} and \ref{fig:lambdaoe} with one modification and two additions.  The introduction rule for $\triplelambda$ is changed to %TODO Give it a name
% \[ \infer{\Gamma \vdash \triplelambda^{FG} e : x =_A y . \delta : F =_{A \rightarrow B} G}
% {\Gamma, x : A, y : A, e : x =_A y \vdash \delta : F x =_B G y} \]
% and we add the rules:
% \[ \infer{\Gamma \vdash M =_A N : \Omega}{\Gamma \vdash M : A \quad \Gamma \vdash N : A} \]
% \[ \infer{\Gamma \vdash \delta =^*_A \epsilon : (M =_A N) =_\Omega (M' =_A N')}
% {\Gamma \vdash \delta : M =_A M' \quad \Gamma \vdash \epsilon : N =_A N'} \]

% We extend the definition of path substitution by
% \[ (N =_B N') \{ \vec{x} := \vec{P} : \vec{M} \sim \vec{M'} \}
% \eqdef N \{ \vec{x} := \vec{P} : \vec{M} \sim \vec{M'} \} =_B^*
% N' \{ \vec{x} := \vec{P} : \vec{M} \sim \vec{M'} \} \enspace . \]

% We define terms $\sym{A}{M}{N}{\delta}$ and $\trans{A}{M}{N}{P}{\delta}{\epsilon}$.
% \begin{align*}
% \sym{\Omega}{\phi}{\psi}{\delta} & \eqdef \univ{\psi}{\phi}{\delta^-}{\delta^+} \\
% \sym{A \rightarrow B}{M}{N}{\delta} & \eqdef \triplelambda p:x =_A y. \sym{B}{My}{Nx}{\delta
% \sym{A}{x}{y}{p}} \\
% & \\
% \trans{\Omega}{\phi}{\psi}{\chi}{\delta}{\epsilon} & \eqdef \univ{\phi}{\chi}
% {\lambda p:\phi.\epsilon^+(\delta^+ p)}{\lambda p:\chi.\delta^-(\epsilon^- p)} \\
% \trans{A \rightarrow B}{M}{N}{P}{\delta}{\epsilon}
% & \eqdef \triplelambda p:x =_A y. \trans{B}{Mx}{Nx}{Py}{\delta_{xx} \reff{x}}{\epsilon_{xy} p}
% \end{align*}

% \begin{lm}
% $ $
% \begin{enumerate}
% \item
% If $\Gamma \vdash \delta : M =_A N$ then $\Gamma \vdash \sym{A}{M}{N}{\delta} : N =_A M$.
% \item
% If $\Gamma \vdash \delta : M =_A N$ and $\Gamma \vdash \epsilon : N =_A P$ then
% $\Gamma \vdash \trans{A}{M}{N}{P}{\delta}{\epsilon} : M =_A P$.
% \end{enumerate}
% \end{lm}

% \begin{proof}
% Straightforward.
% \end{proof}

% The reduction relation is that of $\lambda o e$ together with the following clauses:

% \begin{align*}
% & \reff{M} =^*_A \reff{N}  \\ & \qquad \rhd \reff{M =_A N} \\ \\
% & \reff{\phi} =^*_\Omega \univ{\psi}{\chi}{\delta}{\epsilon}  \\ & \qquad \rhd 
%   \mathsf{univ}_{\phi =_\Omega \psi,\phi =_\Omega \chi} \\
% &  \qquad \qquad \left( \lambda p:\phi =_\psi. \univ{\phi}{\chi}{\lambda q:\phi.\delta (p^+ q)}
%     {\lambda q : \chi. p^- (\epsilon q)}, \right. \\ 
% &  \qquad \qquad \left. \lambda p:\phi =_\Omega \chi. \univ{\phi}{\psi}{\lambda q:\phi. \epsilon (p^+ q)}
%     {\lambda q : \psi. p^- (\delta q)} \right) \\ \\
% & \univ{\phi}{\psi}{\delta}{\epsilon} =^*_\Omega \reff{\chi}  \\ & \qquad \rhd
%   \mathsf{univ}_{\phi =_\Omega \chi, \psi =_\Omega \chi} \\
% & \qquad \qquad   \left( \lambda p:\phi = \chi . \univ{\psi}{\chi}{\lambda q:\psi. p^+ (\epsilon q)}
%       {\lambda q:\chi. \delta (p^- q)}, \right. \\
% & \qquad \qquad   \left. \lambda p:\psi =_\Omega \chi. \univ{\phi}{\chi}{\lambda q:\phi. p^+ (\delta q)}
%       {\lambda q:\chi. \epsilon (p^- q)} \right) \\ \\
% & \univ{\phi}{\psi}{\delta}{\epsilon} =^*_\Omega \univ{\phi'}{\psi'}{\delta'}{\epsilon'}
%  \\ & \qquad \rhd
% \mathsf{univ}_{\phi =_\Omega \phi', \psi =_\Omega \psi'} \\
% & \qquad \qquad \left( \lambda p:\phi = \phi'. \univ{\psi}{\psi'}{\lambda q:\psi. \delta' (p^+ (\epsilon q))}{\lambda q:\psi' . \delta (p^-(\epsilon' q))}, \right. \\
% & \qquad \qquad \left. \lambda p:\psi=_\Omega \psi' . \univ{\phi}{\phi'}{\lambda q:\phi. \epsilon' (p^+ (\delta q))}{\lambda q:\phi' . \epsilon (p^- (\delta' q))} \right) \\ \\
% & \reff{F} =^*_{A \rightarrow B} \triplelambda^{G G'} q:x =_A y. P
%  \\ & \qquad \rhd
% \mathsf{univ}_{F =_{A \rightarrow B} G, F =_{A \rightarrow B} G'} \\
% & \qquad \qquad \left( \lambda p : F =_{A \rightarrow B} G. \triplelambda^{F G'} q : x =_A y. 
% \trans{B}{Fx}{Gx}{G'y}{p_{xx} \reff{x}}{P}, \right. \\
% & \qquad \qquad \lambda p : F =_{A \rightarrow B} G'. \triplelambda^{F G} q : x =_A y. \\
% & \qquad \qquad \left. \trans{B}{Fx}{G'y}{Gx}{p_{xy} q}{\sym{B}{Gx}{G'y}{P}} \right) \\ \\
% & \triplelambda^{F F'} p : x =_A y. P =^*_{A \rightarrow B} \reff{G}
%   \\ & \qquad \rhd
% \mathsf{univ}_{F =_{A \rightarrow B} G,F' =_{A \rightarrow B} G} \\
% & \qquad \qquad \left( \lambda q : F =_{A \rightarrow B} G .
% \triplelambda^{F' G} p : x =_A y. \right. \\
% & \qquad \qquad \trans{B}{F'x}{Fx}{Gy}{\sym{B}{Fx}{F'x}{P [ y := x, p := \reff{x} ] }}
% {
%  q_{xy}p}, \\
% & \qquad \qquad \left. \lambda q:F'=_{A \rightarrow B} G. \triplelambda^{FG} p : x =_A y.
% \trans{B}{Fx}{F'y}{Gy}{P}{q_{yy} \reff{y}} \right)
% \end{align*}

% \begin{align*}
% & (\triplelambda^{F F'} p : x =_A y. P) =^*_{A \rightarrow B} (\triplelambda^{G G'} p : x =_A y . Q)
%  \\ & \qquad \rhd 
% \mathsf{univ}_{F =_{A \rightarrow B} G,F' =_{A \rightarrow B} G'} \\
% & \qquad \qquad \left( \lambda q : F =_{A \rightarrow B} G . \triplelambda^{F' G'} p : x =_A y. \right. \\
% & \qquad \qquad \mathsf{trans}_{B,F'x,Fx,G'y} \left( \sym{B}{Fx}{F'x}{P [ y := x, p := \reff{x} ]} , \right. \\
% & \qquad \qquad \left. \trans{B}{Fx}{Gx}{G'y}{q_{xx} \reff{x}}{Q} \right) , \\
% & \qquad \qquad \lambda q : F' =_{A \rightarrow B} G' . \triplelambda^{FG} p : x =_A y. \\
% & \qquad \qquad \mathsf{trans}_{B, Fx, F'x, Gy} \left( P [ y := x,  p := \reff{x} ] , \right. \\
% & \qquad \qquad \! \! \left. \left. \trans{B}{F'x}{G'y}{Gy}{q_{xy} p}{\sym{B}{Gy}{G'y}{Q [ x := y, p := \reff{y} ] }} \right) \right)
% \end{align*}

% \subsection{Proof of Strong Normalisation}

% All the results of Section \ref{section:meta} hold for $\lambda o i$ as well,
% with very similar proofs.

% We define the sets of computable expressions $E_\Gamma(\phi)$ for propositions
% $\phi$ as in Definition \ref{df:computable}.  The only thing to bear in mind
% is that, in the definition of $E_\Gamma(\phi \supset \psi)$, the
% propositions $\phi$ and $\psi$ might now have the form $M =_A N$.  For completeness, we write out the definition here:

% \begin{align*}
% E_\Gamma(\Omega) \eqdef & \{ M \mid \Gamma \vdash M : \Omega, M \in \SN \} \\
% E_\Gamma(A \rightarrow B) \eqdef & \{ M \mid \Gamma \vdash M : A \rightarrow B, \\
% & \quad \forall (\Delta \supseteq \Gamma) (N \in E_\Delta(A)). MN \in E_\Delta(B), \\
% & \quad \forall (\Delta \supseteq \Gamma) (N, N' \in E_\Delta(A)) (\delta \in E_\Delta(N =_A N')). \\
% & \quad \quad \reff{M}_{N N'} \delta \in E_\Gamma(MN =_B MN') \} \\
% \\
% E_\Gamma(\bot) & \eqdef \{ \delta \mid \Gamma \vdash \delta : \bot, \delta \in \SN \} \\
% E_\Gamma(\phi \supset \psi) & \eqdef \{ \delta \mid \Gamma \vdash \delta : \phi \supset \psi, \\
% & \forall (\Delta \supseteq \Gamma)(\epsilon \in E_\Delta(\phi)). \delta \epsilon \in E_\Gamma(\psi) \} \\
% E_\Gamma(\phi =_\Omega \psi) & \eqdef \{ \delta \mid \Gamma \vdash \delta : \phi =_\Omega \psi, \\
% & \delta^+ \in E_\Gamma(\phi \supset \psi), \delta^- \in E_\Gamma(\psi \supset \phi) \} \\
% E_\Gamma(M =_{A \rightarrow B} M') & \eqdef \{ \delta \mid \Gamma \vdash \delta : M =_{A \rightarrow B} M', \\
% & \forall (\Delta \supseteq \Gamma) (N, N' \in E_\Delta(A)) (\epsilon \in E_\Delta(N =_A N')). \\
% & \delta_{NN'}\epsilon \in E_\Delta(MN =_B M'N') \} \\
% E_\Gamma(\phi) & \eqdef \{ \delta \mid \Gamma \vdash \delta : \phi, \delta \in \SN \} \\
% & \qquad (\phi \text{ neutral}) \\
% E_\Gamma(\phi) & \eqdef E_\Gamma(\nf{\phi}) \\
% & \qquad (\phi \mbox{ a normalizable term of type $\Omega$}) \\
% \end{align*}

% \begin{lemma}
% \label{lm:Ered}
% If $(\triplelambda p:x =_A y. \delta)_{M N} \epsilon \theta_1 \cdots \theta_n \in E_\Gamma(\phi)$
% then $\delta[x:=M, y:=N, p:=\epsilon] \theta_1 \cdots \theta_n \in E_\Gamma(\phi)$.
% \end{lemma}

% \begin{proof}
% The proof is by an induction on $\nf{\phi}$.
% \end{proof}

% \begin{lemma}
% \label{lm:eqstar}
% Let $M, M', N, N' \in E_\Gamma(A)$.
% If $\delta \in E_\Gamma(M =_A M')$ and $\epsilon \in E_\Gamma(N =_A N')$ then
% $\delta =_A^* \epsilon \in E_\Gamma((M =_A N) =_\Omega (M' =_A N'))$.
% \end{lemma}

% \begin{proof}
% We must prove that $(\delta =_A^* \epsilon)^+ \in E_\Gamma(M =_A N \supset M' =_A N')$ and
% $(\delta =_A^* \epsilon)^- \in E_\Gamma(M' =_A N' \supset M =_A N)$.  We prove the first of these; the proof of the second is similar.

% In fact, we prove the following statement, from which the desired conclusion easily follows:

% \begin{quote}
% Let $A \equiv A_1 \rightarrow \cdots \rightarrow A_n \rightarrow \Omega$ be a type.  Let
% \begin{align*}
% \delta & \in E_\Gamma(M =_A M') \\
% \epsilon & \in E_\Gamma(N =_A N') \\
% \chi & \in E_\Gamma(M =_A N) \\
% \theta_i & \in E_\Gamma(L_i =_{A_i} L_i') & (1 \leq i \leq n) \\
% \alpha & \in E_\Gamma(M L_1 \cdots L_n) \\
% N L_1' \cdots L_n' & \twoheadrightarrow_\beta \phi_1 \supset \cdots \supset \phi_m \supset \bot \\
% \beta_j & \in E_\Gamma(\phi_j) & (1 \leq j \leq m)
% \end{align*}
% Then $((\delta =_A^* \epsilon)^+ \chi_{L_1 L_1'} \theta_1 \cdots_{L_n L_n'} \theta_n)^+ \alpha \beta_1 \cdots \beta_m \in \SN$.
% \end{quote}

% The proof is by induction on the fact that $\delta, \epsilon, \chi, \theta_i, \alpha, \beta_j \in \SN$.

% Consider a possible one-step reduction from $((\delta =_A^* \epsilon)^+ \chi \vec{\theta})^+ \alpha \vec{\beta}$.  If the reduction consists of reducing one of the subterms, we apply the induction hypothesis.  The only other possibility is that $\delta =_A^* \epsilon$ is a redex.  There are now seven cases to consider: we give the details for one of them.

% Let $\delta \equiv \triplelambda^{F F'} p : x =_{A_1} y.P$ and $\epsilon \equiv \triplelambda^{G G'} p : x =_{A_1} y. Q$.  We must prove that
% \begin{align*} & \mathsf{univ}_{F =_{A \rightarrow B} G,F' =_{A \rightarrow B} G'} \\
% & \qquad \qquad \left( \lambda q : F =_{A \rightarrow B} G . \triplelambda p : x =_A y. \right. \\
% & \qquad \qquad \mathsf{trans}_{A_2 \rightarrow \cdots \rightarrow A_n \rightarrow B} \left( \sym*{P [ y := x, p := \reff{x} ]} , \right. \\
% & \qquad \qquad \left. \trans*{q_{xx} \reff{x}}{Q} \right) , \\
% & \qquad \qquad \lambda q : F' =_{A \rightarrow B} G' . \triplelambda p : x =_A y. \\
% & \qquad \qquad \mathsf{trans} \left( P [ y := x,  p := \reff{x} ] , \right. \\
% & \qquad \qquad \! \! \left. \left. \trans*{q_{xy} p}{\sym*{Q [ x := y, p := \reff{y} ] }} \right) \right)^+ \chi \vec{\theta})^+ \alpha \vec{\beta} \in \SN \end{align*}
% By Lemma \ref{lm:wte_loi1}, it is sufficient to prove that
% \begin{align*} & ( \left( \lambda q : F =_{A \rightarrow \Omega} G . \triplelambda p : x =_A y. \right. \\
% & \qquad \qquad \mathsf{trans}_{A_2 \rightarrow \cdots \rightarrow A_n \rightarrow \Omega} \left( P[y:=x, p:=\reff{x}] , \right. \\
% & \qquad \qquad \left. \trans*{q_{xx} \reff{x}}{Q} \right) \chi \vec{\theta})^+ \alpha \vec{\beta} \in \SN \end{align*} 
% By Lemma \ref{lm:wte_loi2}, it is sufficient to prove that
% \begin{align*} & ( \left( \triplelambda p : x =_A y. \right. \\
% & \qquad \qquad \mathsf{trans}_{A_2 \rightarrow \cdots \rightarrow A_n \rightarrow \Omega} \left( P[y:=x, p:=\reff{x}] , \right. \\
% & \qquad \qquad \left. \trans*{\chi_{xx} \reff{x}}{Q} \right) \vec{\theta})^+ \alpha \vec{\beta} \in \SN \end{align*} 
% By Lemma \ref{lm:wte_loi3}, it is sufficient to prove that
% \begin{align*}
% & \qquad \qquad (\mathsf{trans}_{A_2 \rightarrow \cdots \rightarrow A_n \rightarrow \Omega} \left( P[x:=L_1, y:=L_1, p:=\reff{L_1}] , \right. \\
% & \qquad \qquad \left. \trans*{\chi_{L_1 L_1} \reff{L_1}}{Q[x:=L_1, y:=L_1', p:=\theta_1]} \right) \theta_2 \cdots \theta_n)^+ \alpha \vec{\beta} \in \SN \end{align*}
% Repeatedly applying Lemma \ref{lm:wte_loi3}, it is sufficient to prove that
% \begin{align*}
% & \qquad \qquad (\mathsf{trans}_\Omega \left( P[x:=L_1, y:=L_1, p:=\reff{L_1}]_{L_2 L_2} \reff{L_2} \cdots_{L_n L_n} \reff{L_n} , \right. \\
% & \qquad \qquad \left. \trans*{\chi_{L_1 L_1} \reff{L_1}}{Q[x:=L_1, y:=L_1', p:=\theta_1]}_{L_2 L_2'} \theta_2 \cdots_{L_n L_n'} \theta_n \right) )^+ \alpha \vec{\beta} \in \SN \end{align*}
%  By Lemma \ref{lm:wte_loi1}, it is sufficient to prove that
% \begin{align*}
% & (\lambda p. (\trans*{\chi_{L_1 L_1} \reff{L_1}}{Q[x:=L_1, y:=L_1', p:=\theta_1]}_{L_2 L_2'} \theta_2 \cdots_{L_n L_n'} \theta_n)^+ \\
% & \quad ((P[x:=L_1, y:=L_1, p:=\reff{L_1}]_{L_2 L_2} \reff{L_2} \cdots_{L_n L_n} \reff{L_n})^+ p)) \alpha \vec{\beta} \in \SN
% \end{align*}
% and
% \begin{align*}
% & \lambda p. (P[x:=L_1, y:=L_1, p:=\reff{L_1}]_{L_2 L_2} \reff{L_2} \cdots_{L_n L_n} \reff{L_n})^- \\
% & \quad ((\trans*{\chi_{L_1 L_1} \reff{L_1}}{Q[x:=L_1, y:=L_1', p:=\theta_1]}_{L_2 L_2'} \theta_2 \cdots_{L_n L_n'} \theta_n)^- p) \in \SN
% \end{align*}

% We prove the first of these here.
% By Lemma \ref{lm:wte_loi2}, it is sufficient to prove that
% \begin{align*}
% & (\trans*{\chi_{L_1 L_1} \reff{L_1}}{Q[x:=L_1, y:=L_1', p:=\theta_1]}_{L_2 L_2'} \theta_2 \cdots_{L_n L_n'} \theta_n)^+ \\
% & \quad ((P[x:=L_1, y:=L_1, p:=\reff{L_1}]_{L_2 L_2} \reff{L_2} \cdots_{L_n L_n} \reff{L_n})^+ \alpha) \vec{\beta} \in \SN
% \end{align*}
% Repeatedly appling the three lemmas again, it is sufficient to prove that
% \begin{align*}
% & (Q [x:= L_1, y := L_1', p:=\theta_1] \vec{\theta})^+ ((\chi \reff{L_1} \cdots
% \reff{L_n})^+ \\
% & \quad ((P[x:=L_1, y:=L_1, p:=\reff{L_1}]_{L_2 L_2} \reff{L_2} \cdots_{L_n L_n} \reff{L_n})^+ \alpha)) \vec{\beta} \in \SN
% \end{align*}

% Now, we have $\delta \in E_\Gamma(M =_A M')$, hence $\delta_{L_1L_1} \reff{L_1}
% \in E_\Gamma(M L_1 = M' L_1)$ and so $P[x := L_1, y := L_1, p := \reff{L_1}]
% \in E_\Gamma(M L_1 = M' L_1)$ by Lemma \ref{lm:Ered}.  Similarly
% $Q[x:=L_1, y:=L_1', p:=\theta_1] \in E_\Gamma(N L_1 = N' L_1')$.  The
% result follows.
% \end{proof}

% We define what it means to be a computable substitution and a computable path substitution as before.

% \begin{theorem}
% $ $
% \begin{enumerate}
% \item
% If $\Gamma \vdash M : A$, and $\sigma : \Gamma \rightarrow \Delta$ is computable,
% then $M [ \sigma ] \in E_\Delta(A)$.
% \item
% If $\Gamma \vdash \delta : \phi$, and $\sigma : \Gamma \rightarrow \Delta$ is computable,
% then $\delta [ \sigma ] \in E_\Delta(\phi[\sigma])$.
% \item
% If $\Gamma \vdash P : M =_A N$, and $\sigma : \Gamma \rightarrow \Delta$ is computable,
% then $P [ \sigma ] \in E_\Delta(M [ \sigma ] =_A N [ \sigma ])$.
% \item
% If $\Gamma \vdash M : A$, $\tau : \sigma \sim \rho : \Gamma \rightarrow \Delta$, and $\tau$, $\sigma$
% and $\rho$ are all computable, then $M \{ \tau : \sigma \sim \rho \} \in E_\Delta(M [ \sigma ] =_A M [ \rho ])$.
% \end{enumerate}
% \end{theorem}

% \begin{proof}
% Induction on derivations, as before.  We use Lemma \ref{lm:eqstar} for the rule
% $(=^*)$.
% \end{proof}

\section{Future Work}

We have shown that it is possible, in a system with non-dependent function types and implication, to give a strongly normalizing,
confluent reduction rule for the univalence constructor.  We now intend to do the same for stronger and stronger systems, getting
ever closer to full homotopy type theory.  The next steps will be:

\begin{itemize}
\item
a system where the equations $M =_A N$ are objects of $\Omega$, allowing us to form propositions such as $M =_A N \supset N =_A M$.
\item
a system with universal quantification over the types $A$, allowing us to form propositions such as $\forall x:A. x =_A x$ and
$\forall x,y : A. x =_A y \supset y =_A x$
\end{itemize}

\begin{frame}
\bibliography{type}
\end{frame}

\appendix

\section{Results about Computable Expressions}

The following are the lemmas about computable expressions needed to prove Theorem \ref{theorem:mainprop}.

\begin{lm}$ $
\label{lm:conv-compute}
\begin{enumerate}
\item
$E_\Gamma(T)$ is closed under reduction.
\item
If $\Gamma \subseteq \Delta$ and $\Delta \vald$ then $E_\Gamma(T) \subseteq E_\Delta(T)$.
\item
If $t \in E_\Gamma(T)$ then $\Gamma \vdash t : T$.  (Hence, if $\Gamma$ is not a valid context, then $E_\Gamma(T) = \emptyset$.)
\item
If $\delta \in E_\Gamma(\phi)$, $\Gamma \vdash \psi : \Omega$ and $\phi \simeq \psi$, then $\delta \in E_\Gamma(\psi)$.
\item
If $P \in E_\Gamma(M =_A N)$, $\Gamma \vdash M' : A$, $\Gamma \vdash N' : A$, $M \simeq M'$ and $N \simeq N'$,
then $P \in E_\Gamma(M' =_A N')$.
\end{enumerate}
\end{lm}

\begin{proof}
These follow easily from the definition of $E_\Gamma(T)$.  Confluence is required for the last two parts.
\end{proof}

As a consequence of Lemma \ref{lm:conv-compute}.4, we can relax the restriction '$\phi$ and $\psi$ are normal forms' in the definition of $E_\Gamma(\phi \supset \psi)$:
\begin{lm}$ $
Let $\phi$ and $\psi$ be weakly normalizable terms, and suppose $\Gamma \vdash \phi : \Omega$ and $\Gamma \vdash \psi : \Omega$.  Then $\delta \in E_\Gamma(\phi \supset \psi)$ if and only if $\Gamma \vdash \delta : \phi \supset \psi$
and, for all $\Delta \supseteq \Gamma$ and $\epsilon \in E_\Delta(\phi)$, we have $\delta \epsilon \in E_\Delta(\psi)$.
\end{lm}

\begin{proof}
Suppose $\delta \in E_\Gamma(\phi \supset \psi)$.  Let $\Delta \supseteq \Gamma$ and $\epsilon \in E_\Delta(\phi)$.  Then $\delta \in E_\Gamma(\nf{\phi} \supset \nf{\psi})$
and $\epsilon \in E_\Delta(\nf{\phi})$, hence $\delta \epsilon \in E_\Delta(\nf{\psi})$.  We also have $\Delta \vdash \delta \epsilon : \psi$, and so $\delta \epsilon \in E_\Delta(\psi)$.

Conversely, suppose the right-hand side holds.  We must show that $\delta \in E_\Gamma(\nf{\phi} \supset \nf{\psi})$.  Let $\Delta \supseteq \Gamma$ and $\epsilon \in
E_\Delta(\nf{\phi})$.  Then $\epsilon \in E_\Delta(\phi)$ by Lemma \ref{lm:conv-compute}.4, and so $\delta \epsilon \in E_\Delta(\psi)$ by hypothesis.  Therefore $\delta \epsilon \in E_\Delta(\nf{\psi})$
as required.
\end{proof}

\begin{lm}
\label{lm:varcompute1}
Let $\phi$ be a weakly normalizable term.
\begin{enumerate}
\item
If $\Gamma \vald$ and $p : \phi \in \Gamma$ then $p \in E_\Gamma(\phi)$.
\item
$E_\Gamma(\phi) \subseteq \SN$.
\end{enumerate}
\end{lm}

\begin{proof}
The two parts are proved simultaneously by induction on $\nf{\phi}$.
Let $\nf{\phi} \equiv \psi_1 \supset \cdots \supset \psi_n \supset \chi$,
where $\chi$ is either $\bot$ or a neutral term.  
\begin{enumerate}
\item
Let $\Delta \supseteq \Gamma$ and $\epsilon_i \in E_\Delta(\psi_i)$ for
each $i$.  We must show that
\[ p \epsilon_1 \cdots \epsilon_n \in E_\Delta(\chi) \]
It is easy to see that $p \vec{\epsilon}$ is well-typed, so it remains to show that $p \vec{\epsilon} \in \SN$.
This holds because each $\epsilon_i$ is strongly normalizing by the induction hypothesis (2).
\item
Let $\delta \in E_\Gamma(\phi)$.  Consider the context $\Delta \equiv \Gamma, p_1 : \psi_1, \ldots, p_n : \psi_n$.
By the induction hypothesis (1), we have that $p_i \in E_\Delta(\psi_i)$, hence
$\delta p_1 \cdots p_n \in E_\Gamma(\chi)$, and so $\delta p_1 \cdots p_n \in \SN$.
It follows that $\delta \in \SN$.
\end{enumerate}
\end{proof}

\begin{lemma}
\label{lm:varcompute2}
Let $A$ be a type.
\begin{enumerate}
\item
If $\Gamma \vald$ and $x : A \in \Gamma$ then $x \in E_\Gamma(A)$.
\item
$E_\Gamma(A) \subseteq \SN$.
\item
If $\Gamma \vald$ and $e : M =_A N \in \Gamma$ and $M, N \in E_\Gamma(A)$ then $e \in E_\Gamma(M =_A N)$.
\item
For all $M$, $N$, we have $E_\Gamma(M =_A N) \subseteq \SN$.
\end{enumerate}
\end{lemma}

\begin{proof}
The four parts are proved simultaneously by induction on $A$.  Let $A \equiv A_1 \rightarrow \cdots \rightarrow A_n \rightarrow \Omega$,
and suppose the lemma holds for each $A_i$.
\begin{enumerate}
\item
Let $\Delta \supseteq \Gamma$.  We must prove the following:
\begin{enumerate}
\item
Given $M_i \in E_\Delta(A_i)$ for $1 \leq i \leq n$, we must show that $x M_1 \cdots M_n \in E_\Delta(\Omega)$.  We have that
each $M_i \in \SN$ by the induction hypothesis, hence $x \vec{M} \in \SN$.

Now, let $\delta \in E_\Delta(x \vec{M})$.  We must show that $(x \vec{M}) \{\} ^+ \delta \in E_\Delta(x \vec{M})$,
i.e. $(\reff{x}_{M_1 M_1} M_1 \{\}_{M_2 M_2} \cdots_{M_n M_n} M_n\{\})^+ \delta \in E_\Delta(x \vec{M})$.
Well-typedness is easy, and strong normalization follows from the fact that each $M_i$ and $M_i \{\}$ is strongly
normalizing by the induction hypothesis (2) and (4).  (Note that $\reff{x}$ cannot be part of a redex, as it is not closed.)
\item
Given $M_i \in E_\Delta(A_i)$ for $1 \leq i \leq k$, and $N_j, N_j' \in E_\Delta(A_j)$ and $P_j \in E_\Delta(M_j =_{A_j} N_j)$ for
$k < j \leq n$, we must show that \\
$(x M_1 \cdots M_k)\{\}_{N_{k+1}N_{k+1}'} (P_{k+1})_{N_{k+2}N_{k+2}'} \cdots_{N_n N_n'} P_n \in E_\Delta(x \vec{M} \vec{N} =_\Omega x \vec{M} \vec{N'})$,
i.e.
\begin{align*}
(\reff{x}_{M_1 M_1} M_1\{\} \cdots_{M_k M_k} M_k\{\}_{M_{k+1} N_{k+1}} P_{k+1} \cdots_{M_n N_n} P_n)^+ \\
\in E_\Delta(x \vec{M} \vec{N} \supset x \vec{M} \vec{N'}) \\
(\reff{x}_{M_1 M_1} M_1\{\} \cdots_{M_k M_k} M_k\{\}_{M_{k+1} N_{k+1}} P_{k+1} \cdots_{M_n N_n} P_n)^- \\
\in E_\Delta(x \vec{M} \vec{N'} \supset x \vec{M} \vec{N})
\end{align*}
The proof is similar to the previous part.
\end{enumerate}
\item
Let $M \in E_\Gamma(A)$.  Then using the induction hypothesis $M x_1 \cdots x_n \in E_{\Gamma, x_1 : A_1, \ldots, x_n : A_n}(\Omega) \subseteq \SN$,
hence $M \in \SN$.
\item
Let $\Delta \supseteq \Gamma$.  Let $L_i, L_i' \in E_\Delta(A_i)$ and
$P_i \in E_\Delta(L_i =_{A_i} L_i')$ for $i = 1, \ldots, n$.  We must show that
$e \vec{P} \equiv e_{L_1 L_1'} P_1 \cdots_{L_n L_n'} P_n \in E_\Delta(M L_1 \cdots L_n =_{\Omega} N L_1' \cdots L_n')$, i.e. that
\begin{align*}
(e \vec{P})^+ \in E_\Delta(M \vec{L} \supset N \vec{L'}) \\
(e \vec{P})^- \in E_\Delta(N \vec{L'} \supset M \vec{L})
\end{align*}
We prove the first of these; the second is similar.

Let $\Theta \supseteq \Delta$.  Let $\delta \in E_\Theta(M \vec{L})$.
Let $\nf{N \vec{L'}} \equiv \phi_1 \supset \cdots \supset \phi_m \supset \chi$,
where $\chi$ is $\bot$ or neutral.  (We know $\nf{N \vec{L'}}$ exists because
$N \vec{L'} \in E_\Delta(\Omega)$.)  Let $\epsilon_j \in E_\Theta(\phi_j)$ for
$j = 1, \ldots, m$.  Then we must show that
\[ (e \vec{P})^+ \delta \epsilon_1 \cdots \epsilon_m \in E_\Theta(\chi) \]
Well-typedness is easy to show, so it remains to show $(e \vec{P})^+ \delta \vec{\epsilon} \in \SN$.  This holds as each $P_i$, $\delta$ and $\epsilon_j$ is
strongly normalizing.
\item
Let $P \in E_\Gamma(M =_A N)$.  Let $\Delta$ be the context
\[ \Gamma, x_1 : A_1, y_1 : A_1, e_1 : x_1 =_{A_1} y_1, \ldots, x_n : A_n, y_n : A_n, e_n : x_n =_{A_n} y_n \enspace \]
Then using the induction hypothesis $P \vec{e} \equiv P_{x_1 y_1} e_1 \cdots_{x_n y_n} e_n \in E_\Gamma(M \vec{x} =_\Omega N \vec{y})$ and so
$(P \vec{e})^+ \in E_\Gamma(M \vec{x} \supset N \vec{y}) \subseteq \SN$, hence $P \in \SN$.
\end{enumerate}
\end{proof}

\begin{lm}
Let $\phi$ be a normalizable term.
\begin{enumerate}
\item
If $p : \phi \in \Gamma$ then $p \in E_\Gamma(\phi)$.
\item
$E_\Gamma(\phi) \subseteq \SN$.
\end{enumerate}
\end{lm}

\begin{proof}
The proof is by induction on $\nf{\phi}$.
Let $\nf{\phi} \equiv \psi_1 \supseteq \cdots \supseteq \psi_n \supseteq \chi$,
where $\chi$ is either $\bot$ or a neutral term.  
\begin{enumerate}
\item
Let $\Delta \supseteq \Gamma$ and $\epsilon_i \in E_\Delta(\psi_i)$ for
each $i$.  We must show that
\[ p \epsilon_1 \cdots \epsilon_n \in E_\Delta(\chi) \]
It is easy to see that $p \vec{\epsilon}$ is well-typed, so it remains to show that $p \vec{\epsilon} \in \SN$.
This holds because each $\epsilon_i$ is strongly normalizing by the induction hypothesis (2).
\item
Let $\delta \in E_\Gamma(\phi)$.  Consider the context $\Delta \equiv \Gamma, p_1 : \psi_1, \ldots, p_n : \psi_n$.
By the induction hypothesis (1), we have that $p_i \in E_\Delta(\psi_i)$, hence
$\delta p_1 \cdots p_n \in E_\Gamma(\chi)$, and so $\delta p_1 \cdots p_n \in \SN$.
It follows that $\delta \in \SN$.
\end{enumerate}
\end{proof}

\begin{lm}
\label{lm:Ebot}
If $\Gamma \vald$ then $\bot \in E_\Gamma(\Omega)$.
\end{lm}

\begin{proof}
It is immediate that $\Gamma \vdash \bot : \Omega$ and $\bot \in \SN$.  It remains only to show that $\reff{\bot} \in E_\Gamma(\bot =_\Omega \bot)$, i.e. that
$$ \reff{\bot}^+, \reff{\bot}^- \in E_\Gamma(\bot \supset \bot) \enspace . $$
Let $\Delta \supseteq \Gamma$ and $\delta \in E_\Delta(\bot)$.  We must show that $\reff{\bot}^+ \delta, \reff{\bot}^- \delta \in \SN$.

Every possible reduction sequence from $\reff{\bot}^+ \delta$ reduces to $(\lambda p:\bot.p) \nf{\delta}$.  If $\nf{\delta}$ is not closed, it terminates here; otherwise, it reduces to $\nf{\delta}$ and then terminates.  Thus, $\reff{\bot}^+ \delta \in \SN$.

Similarly for $\reff{\bot}^- \delta$.
\end{proof}

Our next aim is to prove that, if $M \in E_\Gamma(A)$, then $\reff{M} \in E_\Gamma(M =_A M)$.  In order to prove this,
we need the following technical result.

\begin{lm}
\label{lm:pre-ref}
Suppose:
\begin{enumerate}
\item
$M \in E_\Gamma(A_1 \rightarrow \cdots \rightarrow A_n \rightarrow \Omega)$.
\item
For $1 \leq i \leq n$, we have $N_i, N_i' \in E_\Gamma(A_i)$ and $P_i \in E_\Gamma(N_i =_{A_i} N_i')$.
\end{enumerate}
Then $(\reff{M}_{N_1 N_1'} P_1 \cdots_{N_n N_n'} P_n)^+ \in E_\Gamma(M N_1 \cdots N_n \supset M N_1' \cdots N_n')$
and $(\reff{M}_{N_1 N_1'} P_1 \cdots_{N_n N_n'} P_n)^- \in E_\Gamma(M N_1' \cdots N_n' \supset M N_1 \cdots N_n)$.
\end{lm}

\begin{proof}
We shall prove that $(\reff{M} \vec{P})^+ \in E_\Gamma(M \vec{N} \supset M \vec{N'})$.  The proof for
$(\reff{M} \vec{P})^- \in E_\Gamma(M \vec{N}' \supset M \vec{N})$.

It is easy to check that $(\reff{M} \vec{P})^+$ is well-typed.  So we have to show the following.  If
\begin{enumerate}
\item
$\delta \in E_\Gamma(M N_1 \cdots N_n)$;
\item
$\nf{M N_1' \cdots N_n'} \equiv \phi_1 \supset \cdots \supset \phi_m \supset \chi$ where $\chi$
is either $\bot$ or a neutral term;
\item
for $1 \leq j \leq m$, we have $\epsilon_j \in E_\Gamma(\phi_j)$;
\end{enumerate}
then $(\reff{M}_{N_1 N_1'} P_1 \cdots_{N_n N_n'} P_n)^+ \delta \epsilon_1 \cdots \epsilon_m \in E_\Gamma(\chi)$.

The proof is by induction on $n$, then on the proofs that $M, N_i, N_i', P_i, \delta, \epsilon_j \in \SN$.

\begin{enumerate}
\item
\label{Case 1}
Case $n = 0$:

Consider all possible one-step
reductions from $(\reff{M} \vec{P})^+ \delta \vec{\epsilon}$.  There are the following possibilities:
\begin{enumerate}
\item
\label{Case 1.1}
$\reff{M}^+ \delta \vec{\epsilon} \rightarrow \reff{M'}^+ \delta \vec{\epsilon}$, where
$M \rightarrow M'$.

In this case, the result follows immediately from the induction hypothesis on $M$.  Similarly for the case where we reduce
$\delta$ or one of the $\epsilon_j$.
\item
\label{Case 1.2}
$\reff{M}^+ \delta \vec{\epsilon} \rightarrow (\lambda p:M.p)\delta \vec{\epsilon}$

Since $\delta \in E_\Gamma(M) = E_\Gamma(\nf{M}) = E_\Gamma(\phi_1 \supset \cdots \supset \phi_m \supset \chi)$, we have that
$\delta \vec{\epsilon} \in \SN$.  Hence $(\lambda p:\phi.p) \delta \vec{\epsilon} \in \SN$ by Propositiol \ref{prop:SN}.\ref{prop:SNP}.
\end{enumerate}
\item
Induction step

Suppose the result holds for $n$.  Consider all possible one-step reductions from $(\reff{M} P_1 \cdots P_{n+1})^+ \delta \vec{\epsilon}$.
There are the following possibilities:
\begin{enumerate}
\item
$(\reff{M} \vec{P})^+ \delta \vec{\epsilon} \rightarrow (\reff{M'} \vec{P})^+ \delta \vec{\epsilon}$, where
$M \rightarrow M'$.

Just as in Case \ref{Case 1.1} above, the result follows immediately from the induction hypothesis on $M$.  Similarly for the case where we reduce one of the $P_i$, $\delta$ or $\epsilon_j$.
\item
$P_1 \equiv \reff{L}$ and $(\reff{M} \vec{P})^+ \delta \vec{\epsilon} \rightarrow (\reff{M L} P_2 \cdots P_n)^+ \delta \vec{\epsilon}$

In this case, we have that $M$ and $L$ are closed normal forms.  By Generation, we know $N_1 \simeq N_1' \simeq L$, hence $N_1, N_1' \twoheadrightarrow L$
by Confluence, and thus $L \in E_\Gamma(A_1)$.  It follows that $ML \in E_\Gamma(A_2 \rightarrow \cdots \rightarrow A_n \rightarrow \Omega)$, and
the result follows by the induction hypothesis on $n$.
\item
$M \equiv \lambda x:C.L$ and $(\reff{M} \vec{P})^+ \delta \vec{\epsilon} \rightarrow (L \{ x := P_1 : N_1 \sim N_1 \} P_2 \cdots P_n)^+ \delta \vec{\epsilon}$

We have $\lambda x:C.L \in E_\Gamma(A_1 \rightarrow \cdots \rightarrow A_n \rightarrow \Omega)$, and hence
\[ (\lambda x:C.L)\{\}_{N_1 N_1'} P_1 \in E_\Gamma(M N_1 =_{A_2 \rightarrow \cdots \rightarrow A_n \rightarrow \Omega} M N_1') \enspace , \]
i.e.
\[ (\triplelambda e : x =_C y. L \{ x := e \})_{N_1 N_1'} P_1 \in E_\Gamma(M N_1 =_{A_2 \rightarrow \cdots \rightarrow A_n \rightarrow \Omega} M N_1') \enspace . \]
Noting that $M$, $N_1$, $N_1'$ and $P_1$ are closed normal forms, it follows that
\[ L \{ x:= e : x \sim y \} [ x := N_1, y = N_1', e := P_1 ] \in E_\Gamma(M N_1 = M N_1') \enspace , \]
i.e.
\[ L \{ x := P_1 : N_1 \sim N_1' \} \in E_\Gamma(M N_1 = M N_1') \]
and the desired result follows.
\end{enumerate}
\end{enumerate}
\end{proof}

\begin{lm}
\label{lm:Eref}
If $M \in E_\Gamma(A)$ then $\reff{M} \in E_\Gamma(M =_A M)$.
\end{lm}

\begin{proof}
We prove the following stronger statement:

If $M \in E_\Gamma(A_1 \rightarrow \cdots \rightarrow A_n \rightarrow B)$ and, for all $i$, we have
$N_i, N_i' \in E_\Gamma(A_i)$ and $P_i \in E_\Gamma(N_i =_{A_i} N_i')$, then $\reff{M}_{N_1 N_1'} (P_1)_{N_2 N_2'}
\cdots_{N_n N_n'} P_n \in E_\Gamma(M N_1 \cdots N_n =_B M N_1' \cdots N_n')$.

The proof is by induction on the type $B$.

If $B \equiv \Omega$: we have that $\Gamma \vdash \reff{M} \vec{P} : M \vec{N} =_B M \vec{N'}$, so it remains
to show that $(\reff{M} \vec{P})^+ \in E_\Gamma(M \vec{N} \supset M \vec{N'})$ and $(\reff{M} \vec{P})^- \in E_\Gamma(M \vec{N'} \supset
M \vec{N})$.  These follow from Lemma \ref{lm:pre-ref}.

If $B \equiv A_{n+1} \rightarrow C$, then let $N_{n+1}, N_{n+1}' \in E_\Gamma(A_{n+1})$ and \\
$P_{n+1} \in E_\Gamma(N_{n+1} =_{A_{n+1}} N_{n+1}')$.  We must show that
$\reff{M} \vec{P}_{N_{n+1} N_{n+1}'} P_{n*1} \in E_\Gamma(M \vec{N} N_{n+1} =_C M \vec{N'} N_{n+1}')$.  This follows
from the induction hypothesis.
\end{proof}

\begin{lm}
\label{lm:Esupset}
If $P \in E_\Gamma(\phi =_\Omega \phi')$ and $Q \in E_\Gamma(\psi =_\Omega \psi')$ then
$P \supset^* Q \in E_\Gamma(\phi \supset \psi =_\Omega \phi' \supset \psi')$.
\end{lm}

\begin{proof}
We must prove that $(P \supset^* Q)^+ \in E_\Gamma((\phi \supset \psi) \supset \phi' \supset \psi')$ and
$(P \supset^* Q)^- \in E_\Gamma((\phi' \supset \psi') \supset \phi \supset \psi)$.  We prove the following
two stronger statements:

\begin{enumerate}
\item
Suppose $P \in E_\Gamma(\phi =_\Omega \phi')$ and $Q \in E_\Gamma(\psi =_\Omega \psi_1 \supset \cdots \supset \psi_n \supset \chi)$.
Let $\delta \in E_\Gamma(\phi \supset \psi)$, $\epsilon \in E_\Gamma(\phi')$, and $\epsilon_i \in E_\Gamma(\psi_i)$ for all $i$.
Then $(P \supset^* Q)^+ \delta \epsilon \epsilon_1 \cdots \epsilon_n \in E_\Gamma(\chi)$.
\item
Suppose $P \in E_\Gamma(\phi =_\Omega \phi')$ and $Q \in E_\Gamma(\psi_1 \supset \cdots \supset \psi_n \supset \chi =_\Omega \psi')$.
Let $\delta \in E_\Gamma(\phi' \supset \psi')$, $\epsilon \in E_\Gamma(\phi)$, and $\epsilon_i \in E_\Gamma(\psi_i)$ for all $i$.
Then $(P \supset^* Q)^- \delta \epsilon \epsilon_1 \cdots \epsilon_n \in E_\Gamma(\chi)$.
\end{enumerate}

We give the details for statement 1 here; the proof for 2 is similar.

We prove statement 1 by induction on $\nf{\chi}$.

If $\nf{\chi}$ is $\bot$ or neutral, then we must show that $(P \supset^* Q)^+ \delta \epsilon \vec{\epsilon} \in \SN$.  We prove this
by a secondary induction on the proofs that $P, Q, \delta, \epsilon, \epsilon_i \in \SN$.  The following are the possible
one-step reductions from $(P \supset^* Q)^+ \delta \epsilon \vec{\epsilon}$:

\begin{itemize}
\item
$(P \supset^* Q)^+ \delta \epsilon \vec{\epsilon} \rightarrow (P' \supset^* Q) \delta \epsilon \vec{\epsilon}$ where $P \rightarrow P'$.

In this case, the result we require follows by the induction hypothesis on $P$.  Similarly if we reduce $Q$, $\delta$, $\epsilon$
or any of the $\epsilon_i$.
\item
$P \equiv \reff{\phi}$, $Q \equiv \reff{\psi}$, and $(P \supset^* Q)^+ \delta \epsilon \vec{\epsilon} \rightarrow \reff{\phi \supset \psi}^* \delta \epsilon \vec{\epsilon}$.

Generation gives $\phi \simeq \phi'$ and $\psi \simeq \psi_1 \supset \cdots \supset \psi_n \supset \chi$.
Then the only possible reduction sequence from $\reff{\phi \supset \psi}^* \delta \epsilon \vec{\epsilon}$ is
\[ \reff{\phi \supset \psi}^* \delta \epsilon \vec{\epsilon} \rightarrow (\lambda p p) \delta \epsilon \vec{\epsilon} \rightarrow \delta \epsilon \vec{\epsilon} \]
which is in $\SN$ since $\delta \in E_\Gamma(\phi \supset \psi)$.
\item
$P \equiv \univ*{\alpha}{\beta}$, $Q \equiv \univ*{\alpha'}{\beta'}$, and \\
$(P \supset^* Q)^+ \delta \epsilon \vec{\epsilon} \rightarrow \univ*{\lambda pq.\alpha' (p (\beta q))}{\lambda pq.\beta' (p (\alpha q))}^+ \delta \epsilon \vec{\epsilon}$.

Then the only possible reduction sequence from \\
$\univ*{\lambda pq.\alpha' (p (\beta q))}{\lambda pq.\beta' (p (\alpha q))}\delta \epsilon \vec{\epsilon}$ is

\begin{align*}
\lefteqn{\univ*{\lambda pq.\alpha' (p (\beta q))}{\lambda pq.\beta' (p (\alpha q))}^+ \delta \epsilon \vec{\epsilon}} \\
& \rightarrow (\lambda pq.\alpha' (p (\beta q))) \delta \epsilon \vec{\epsilon} \\
& \twoheadrightarrow \alpha' (\delta (\beta \epsilon)) \vec{\epsilon}
\end{align*}
Now, we know $P^- \in E_\Gamma(\phi' \supset \phi)$ hence $\beta \in E_\Gamma(\phi' \supset \phi)$, and so $\beta \epsilon \in E_\Gamma(\phi)$.  Similarly
$\alpha' \in E_\Gamma(\psi \supset \psi_1 \supset \cdots \supset \psi_n \supset \chi)$, and so $\alpha' (\delta (\beta \epsilon)) \vec{\epsilon} \in E_\Gamma(\bot) \subseteq \SN$ as required.
\item
$P \equiv \univ*{\alpha}{\beta}$, $Q \equiv \reff{\psi}$ and $(P \supset^* Q)^+ \delta \epsilon \vec{\epsilon} \rightarrow \univ*{\lambda pq.p(\beta q)}{\lambda pq.p(\alpha q)}$

Similar to the above.
\item
$P \equiv \reff{\phi}$, $Q \equiv \univ*{\alpha}{\beta}$ and $(P \supset^* Q)^+ \delta \epsilon \vec{\epsilon} \rightarrow \univ*{\lambda pq.\alpha(pq)}{\lambda pq.\beta(pq)}$

Similar to the above.
\end{itemize}

If $\nf{\chi} \equiv \psi_{n+1} \supset \chi'$, then let $\Delta \supseteq \Gamma$ and $\epsilon_{n+1} \in E_\Delta(\psi_{n+1})$.  The induction hypothesis gives
\[ (P \supset^* Q)^+ \delta \epsilon \vec{\epsilon} \epsilon_{n+1} \in E_\Delta(\chi') \]
as required.
\end{proof}

\begin{lemma}
\label{lm:Euniv}
If $\delta \in E_\Gamma(\phi \supset \psi)$ and $\epsilon \in E_\Gamma(\psi \supset \phi)$, then $\univ{\phi}{\psi}{\delta}{\epsilon} \in E_\Gamma(\phi =_\Omega \psi)$.
\end{lemma}

\begin{proof}
Similar.
\end{proof}

% \section{About the Formalization}

% \input{Prelims.tex}
% \mode<all>{\input{Grammar/Taxonomy.tex}}
% \mode<all>{\input{Grammar/Base.tex}}

% We define the operations of replacement and substitution on
% expressions.  

% \input{Grammar/Substitution/PreOpFamily.tex}
% \input{Grammar/Substitution/OpFamily.tex}

% The details are given in Appendix \ref{appendix:repsub}.

% \input{Grammar/Context.tex}
% \input{Reduction/Base.tex}
% \input{Reduction/SN.tex}
% %\input{PL/Grammar.tex}
% %\input{PL/Rules.tex}
% %\input{PL/Computable.tex}

% \section{Replacement and Substitution}
% \label{appendix:repsub}

% \input{Grammar/OpFamily/PreOpFamily.tex}
% \input{Grammar/OpFamily/Lifting.tex}
% \input{Grammar/OpFamily/LiftFamily.tex}
% \input{Grammar/OpFamily/Composition.tex}
% \input{Grammar/OpFamily/OpFamily.tex}
% \input{Grammar/Replacement.tex}
% \input{Grammar/Substitution/Lifting.tex}
% \input{Grammar/Substitution/RepSub.tex}
% \input{Grammar/Substitution/LiftFamily.tex}
% \input{Grammar/Substitution/Botsub.tex}

\end{document}
