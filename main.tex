\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{bbm}
\usepackage[greek,english]{babel}
\usepackage{ucs}
\usepackage[utf8x]{inputenc}
\usepackage{autofe}
\usepackage{fancyvrb}
\usepackage{proof}
\usepackage{stmaryrd}
\usepackage{todo}

\DeclareUnicodeCharacter{8598}{\ensuremath{\nwarrow}}
\DeclareUnicodeCharacter{8599}{\ensuremath{\nearrow}}
\DeclareUnicodeCharacter{8608}{\ensuremath{\twoheadrightarrow}}
\DeclareUnicodeCharacter{8657}{\ensuremath{\Uparrow}}
\DeclareUnicodeCharacter{8667}{\ensuremath{\Rrightarrow}}
\DeclareUnicodeCharacter{8718}{\ensuremath{\qed}}
\DeclareUnicodeCharacter{8759}{\ensuremath{::}}
\DeclareUnicodeCharacter{8988}{\ensuremath{\ulcorner}}
\DeclareUnicodeCharacter{8989}{\ensuremath{\urcorner}}
\DeclareUnicodeCharacter{8803}{\ensuremath{\overline{\equiv}}}
\DeclareUnicodeCharacter{9001}{\ensuremath{\langle}}
\DeclareUnicodeCharacter{9002}{\ensuremath{\rangle}}
\DeclareUnicodeCharacter{9655}{\ensuremath{\rhd}}
\DeclareUnicodeCharacter{10214}{\ensuremath{[}}
\DeclareUnicodeCharacter{10215}{\ensuremath{]}}
\DeclareUnicodeCharacter{10219}{\ensuremath{\rangle\rangle}}


\usepackage{textalpha}

\DefineVerbatimEnvironment{code}{Verbatim}{fontsize=\footnotesize}

% \newtheorem{lemma}{Lemma}[section]
% \newtheorem{corollary}[lemma]{Corollary}
\newtheorem{prop}{Proposition}[section]
% \newtheorem{theorem}{Theorem}[section]
% \theoremstyle{definition}
% \newtheorem{definition}[lemma]{Definition}

\newcommand{\Set}{\mathbf{Set}}
\newcommand{\eqdef}{\mathrel{\smash{\stackrel{\text{def}}{=}}}}
\newcommand{\AgdaHide}[1]{}
\newcommand{\isotoid}{\ensuremath{isotoid}}
\newcommand{\vald}{\ensuremath{\ \mathrm{valid}}}
\newcommand{\reff}[1]{\ensuremath{\mathsf{ref} \left( {#1} \right)}}
\newcommand{\univ}[4]{\ensuremath{\mathsf{univ}_{{#1} , {#2}} \left( {#3} , {#4} \right)}}
\newcommand{\triplelambda}{\lambda \!\! \lambda \!\! \lambda}
\newcommand{\SN}{\mathbf{SN}}

\begin{document}

\begin{frame}
\maketitle

\mode<beamer>{
\begin{small}
\begin{center}
This talk is a literate Agda file
\texttt{https://github.com/radams78/Univalence}
\end{center}
\end{small}
}
\end{frame}

\section{Introduction}

\mode<beamer>{
\begin{frame}
\frametitle{Type Theory Orthoodoxy}
\begin{itemize}[<+->]
\item
To enjoy a good meaning explanation, a type theory should enjoy these properties:
\begin{itemize}
\item \textbf{Confluence} --- Reduction is confluent.
\item \textbf{Strong Normalization} --- Every reduction strategy terminates.
\item \textbf{Canonicity} --- Hence every well-typed term of type $A$ reduces to a unique canonical form of $A$.
\begin{itemize}
\item
E.g. every closed term of type $\mathbb{N}$ reduces to a unique numeral.
\end{itemize}
\end{itemize}
\item 
The \emph{univalence axiom} postulates a function
\[ \isotoid : A \simeq B \rightarrow A = B \]
that is an inverse to the obvious function $A = B \rightarrow A \simeq B$.
\item
This breaks canonicity.
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{Possible Solutions}
\begin{itemize}[<+->]
\item
Lower our standards
\begin{itemize}
\item
\textbf{Voevodsky's Conjecture --- Propositional Canonicity}

For every closed term $t : \mathbb{N}$, there exists a numeral $n$ and a proof $\vdash p : Id_\mathbb{N}(t,n)$.
\end{itemize}
\item
Use a type theory in which $\isotoid$ is definable (Cubical Type Theory, \cite{Polonsky14a}) %TODO Cite
\item
Introduce a reduction rule for $\isotoid$.
\end{itemize}
\end{frame}
%TODO Look up other possible solutions.

\begin{frame}
\frametitle{Our Approach}
We begin with a small type theory, and work our way up to the full HoTT. %Too much?
\begin{enumerate}
\item \textbf{$\lambda o e$ --- Predicative Higher-Order Propositional Logic}

 A type theory with:
  \begin{itemize}
  \item a universe $\Omega$ of \emph{propositions} with $\bot$ and $\supset$
  \item a universe $U$ of \emph{small types} with $\Omega$ and $\rightarrow$
  \item for any two terms $M, N : A$, a (large) type $M =_A N$.
  \end{itemize}
\item \textbf{$\lambda o i$ --- P.H.O.P.L. with Equality}

Make $\delta =_\phi \epsilon$ a proposition.  (So we can form propositions like $M =_A N \supset N =_A M$.)
\end{enumerate}
For the future: universal quantification, natural numbers, inductive types, path elimination, \ldots
\end{frame}
%TODO Better names
}

According to the traditional approach to type theory \todo{Citation}, a type theory should have the
following properties in order to enjoy a good meaning explanation:
\begin{itemize}
\item \textbf{Confluence} --- The reduction relation should be confluent.
\item \textbf{Strong Normalization} --- Every reduction strategy should terminate.
\item \textbf{Canonicity} --- Hence every well-typed term of type $A$ reduces to a unique canonical form of $A$.  (For example,
every closed term of type $\mathbb{N}$ reduces to a unique \emph{numeral} --- a term formed by applying $\mathrm{suc}$ some
finite number of times to 0.)
\end{itemize}

The \emph{univalence axiom} of Homotopy Type theory (HoTT) \todo{Citation} breaks the property of canonicity.  It postulates a
constant
\[ \isotoid : A \simeq B \rightarrow A = B \]
that is an inverse to the canonical function $A = B \rightarrow A \simeq B$.  When a computation reaches a point
where we eliminate a path (proof of equality) formed by $\isotoid$, it gets 'stuck'.

As possible solutions to this problem, we may try to do with a weaker property than canonicity, such as \emph{propositional canonicity}.
We may attempt to prove that every closed term of type $\mathbb{N}$ is \emph{propositionally} equal to a numeral.  (This is known as
\emph{Voevodsky's Conecture} \todo{Cite}.)  Or we may attempt to change the definition of equality to make $\isotoid$ definable (\cite{Polonsky14a}), or
shift to an entirely different type theory such as Cubical Type Theory \todo{Cite}.

We could also try a more conservative approach, and simply attempt to find a reduction relation for a type theory involving $\isotoid$ that satisfies
all three of the properties above.  There seems to be no reason \emph{a priori} to believe this is not possible, but it is difficult to do because
the full Homotopy Type Theory is a complex and interdependent system.  We can tackle the problem by adding univalence to a much simpler system, finding
a well-behaved reduction relation, then doing the same for more and more complex systems, gradually approaching the full strength of HoTT.

In this paper, we present a system we call $\lambda o e$, or predicative higher-order propositional logic.  It is a type theory with two universes: the universe $\Omega$
of \emph{propositions}, and the universe $U$ of \emph{types}.  The propositions are closed under $\sup$ (implication) and include $\bot$ (falsehood), and an equality proposition $M =_A N$ for
any type $A : U$ and terms $M : A$ and $N : A$.  The types include $\Omega$ itself and are closed under $\rightarrow$ (non-dependent function type).

There are two canonical forms for proofs of $M =_A N$.  For any term $M : A$, we have $\reff{M} : M =_A M$.  We also add univalence for this system, in this form:
if $\delta : \phi \sup \psi$ and $\epsilon : \psi \sup \phi$, then $\univ{\phi}{\psi}{\delta}{\epsilon} : \phi =_\Omega \psi$.  We present a reduction relation for this system, and prove it satisfies confluence, strong normalization and canonicity. \todo{Cross-reference lemma numbers.}  The reduction relation does not necessarily satisfy confluence on raw terms, but it does satisfy local confluence.  Hence, as
every typed term is strongly normalizing, we know by Newman's Lemma that the reduction is confluent on the typed terms.

For the future, we wish to expand the system with universal quantification, and expand it to a 2-dimensional system (with equations between proofs).

\todo{Elimination of the false proposition?}

\section{Predicative Higher-Order Propositional Logic}

\mode<all>{\input{PHOPL/Grammar.lagda}}
\mode<all>{\input{PHOPL/Rules.lagda}}

\subsection{The Reduction Relation}

\mode<all>{\input{PHOPL/Red.lagda}}

\subsection{Strong Normalization Proof}

\mode<all>{\input{PHOPL/Computable.lagda}}
\mode<all>{\input{PHOPL/MainProp1.lagda}}
\mode<all>{\input{PHOPL/MainProp.lagda}}

\section{$\lambda o i$}

\begin{frame}
\frametitle{Include equations in $\Omega$}

\begin{itemize}
\item
We can include the equations $M =_A N$ in our logic.
\onslide<2->{
\item
Now we can form (and prove) $sym_{MN} : M =_A N \supset N =_A M$ and $trans_{MNP} : M =_A N \supset N =_A P \supset M =_A P$ (by recursion on $A$).}
\end{itemize}

\[ \infer{\Gamma \vdash M =_A N : \Omega}{\Gamma \vdash M : A \quad \Gamma \vdash N : A} \]
\only<2->{\[ \infer{\Gamma \vdash \delta =^*_A \epsilon : (M =_A N) =_\Omega (M' =_A N')}
{\Gamma \vdash \delta : M =_A M' \quad \Gamma \vdash \epsilon : N =_A N'} \]}

\pause

New computation rules include:

\[ (\triplelambda^{F,G} e:x =_A y . \delta) =^* \reff{H} \]
\[ \rhd \mathsf{univ}_{F = H,G = H}(\lambda p. \triplelambda e:x=_Ay. (Gx =_{sym\ \delta} F y =_{p \reff{y}} H y), \]
\[ \lambda p. \triplelambda e:x=_A y. (F x =_{\delta} G y =_{p \reff{y}}) \]
\end{frame}

\section{Conclusion}

\begin{frame}
\frametitle{Conclusion}
\begin{itemize}[<+->]
\item
We have shown two systems that each have all these properties:
\begin{itemize}
\item
Univalence
\item
Strong Normalization
\item
Confluence of typed terms
\item
Canonicity
\end{itemize}
\item
So it is possible!
\item
The simplicity is due to the separation between terms and proofs.
\item
For the future: extract a normalizer.  Universal quantification.
\item
Follow the progress here: \url{www.github.com/radams78/Univalence}
\end{itemize}
\end{frame}

\todos

\begin{frame}
\frametitle{Bibliography}
\bibliography{../../../type}
\end{frame}

\appendix

\section{About the Formalization}

\begin{frame}
\frametitle{About the Formalization}
This work is being formalized in Agda (work in progress).
\pause

It will involve several systems and reduction relations.

I want to prove only once:
\pause
\begin{itemize}[<+->]
\item
$M[x:=N][y:=P] \equiv M[y:=P[x:=N]][x:=N]$
\item
If $M \twoheadrightarrow N$ then $M[x:=P] \twoheadrightarrow N[x:=P]$
\item
If $M[x:=P]$ is SN then $M$ is SN.
\item
Etc.
\end{itemize}
\pause
The formalization includes a general notion of `grammar' and `reduction relation'.  (To do: general notion of derivation rules.)
\end{frame}

\input{Prelims.lagda}
\mode<all>{\input{Grammar/Taxonomy.lagda}}
\mode<all>{\input{Grammar/Base.lagda}}

We define the operations of replacement and substitution on
expressions.  

\input{Grammar/Substitution/PreOpFamily.lagda}
\input{Grammar/Substitution/OpFamily.lagda}

The details are given in Appendix \ref{appendix:repsub}.

\input{Grammar/Context.lagda}
\input{Reduction/Base.lagda}
\input{Reduction/SN.lagda}
%\input{PL/Grammar.lagda}
%\input{PL/Rules.lagda}
%\input{PL/Computable.lagda}

\section{Replacement and Substitution}
\label{appendix:repsub}

\input{Grammar/OpFamily/PreOpFamily.lagda}
\input{Grammar/OpFamily/Lifting.lagda}
\input{Grammar/OpFamily/LiftFamily.lagda}
\input{Grammar/OpFamily/Composition.lagda}
\input{Grammar/OpFamily/OpFamily.lagda}
\input{Grammar/Replacement.lagda}
\input{Grammar/Substitution/Lifting.lagda}
\input{Grammar/Substitution/RepSub.lagda}
\input{Grammar/Substitution/LiftFamily.lagda}
\input{Grammar/Substitution/Botsub.lagda}

\end{document}
